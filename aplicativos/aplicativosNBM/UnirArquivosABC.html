<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Unir Arquivos ABC</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f4f6f8;
  padding:20px;
}
.container{
  max-width:900px;
  margin:auto;
  background:#fff;
  padding:20px;
  border-radius:8px;
  box-shadow:0 4px 10px rgba(0,0,0,.1);
}
h1{text-align:center}
section{margin-bottom:20px}
button{
  padding:10px 20px;
  font-size:16px;
  cursor:pointer;
}
textarea{
  width:100%;
  height:320px;
  font-family:monospace;
  white-space:pre;
}
small{color:#666}
input[type="text"],
input[type="number"]{
  padding:8px;
  font-size:15px;
  width:100%;
  box-sizing:border-box;
}
.actions{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
</style>
</head>

<body>
<div class="container">
  <h1>ğŸ¼ Unir Arquivos ABC</h1>

  <!-- Arquivos individuais -->
  <section>
    <h3>ğŸ“„ Selecionar arquivos</h3>
    <input type="file" id="files" multiple accept=".txt">
  </section>

  <!-- Pasta -->
  <section>
    <h3>ğŸ“ Selecionar pasta</h3>
    <input type="file" id="folder" webkitdirectory multiple>
    <br>
    <small>Chrome, Edge, Brave e Android</small>
  </section>

  <!-- Nome do arquivo -->
  <section>
    <h3>ğŸ“ Nome do arquivo final</h3>
    <input type="text" id="nomeArquivo" value="abc_unificado.txt">
  </section>

  <!-- NumeraÃ§Ã£o -->
  <section>
    <h3>ğŸ”¢ NÃºmero inicial do X:</h3>
    <input type="number" id="inicioX" value="1" min="1">
    <small>SÃ³ renumera se o arquivo tiver X:</small>
  </section>

  <button onclick="processar()">Unir arquivos</button>

  <textarea id="resultado" placeholder="ABC unificado aparecerÃ¡ aqui..."></textarea>

  <br><br>

  <div class="actions">
    <button onclick="baixar()">ğŸ’¾ Baixar ABC</button>
    <button onclick="copiar()">ğŸ“‹ Copiar resultado</button>
  </div>
</div>

<script>
let abcFinal = "";

function processar(){
  const filesInput = document.getElementById("files").files;
  const folderInput = document.getElementById("folder").files;

  // Junta arquivos individuais + pasta
  const arquivos = [...filesInput, ...folderInput]
    .filter(f => f.name.toLowerCase().endsWith(".txt"));

  if(!arquivos.length){
    alert("Selecione arquivos ou uma pasta com arquivos .txt");
    return;
  }

  // Ordena pelo caminho/nome (melhor para pastas)
  arquivos.sort((a, b) =>
    (a.webkitRelativePath || a.name)
      .localeCompare(b.webkitRelativePath || b.name)
  );

  let contadorX = parseInt(document.getElementById("inicioX").value, 10);
  if(isNaN(contadorX) || contadorX < 1) contadorX = 1;

  abcFinal = "";
  let lidos = 0;

  arquivos.forEach(file => {
    const reader = new FileReader();

    reader.onload = e => {
      let texto = e.target.result
        .replace(/\r\n/g, "\n")
        .trim();

      if(texto){
        // SÃ³ renumera se existir X:
        if(/^X:\s*\d+/m.test(texto)){
          texto = texto.replace(/^X:\s*\d+/m, "X:" + contadorX);
          contadorX++;
        }
        abcFinal += texto + "\n\n";
      }

      lidos++;
      if(lidos === arquivos.length){
        document.getElementById("resultado").value = abcFinal.trim();
      }
    };

    reader.readAsText(file, "UTF-8");
  });
}

function baixar(){
  if(!abcFinal.trim()){
    alert("Nenhum conteÃºdo para salvar.");
    return;
  }

  let nome = document.getElementById("nomeArquivo").value.trim();
  if(!nome) nome = "abc_unificado.txt";
  if(!nome.toLowerCase().endsWith(".txt")) nome += ".txt";

  const blob = new Blob([abcFinal.trim()], {
    type:"text/plain;charset=utf-8"
  });

  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = nome;
  a.click();
  URL.revokeObjectURL(a.href);
}

function copiar(){
  if(!abcFinal.trim()){
    alert("Nada para copiar.");
    return;
  }

  navigator.clipboard.writeText(abcFinal.trim())
    .then(() => alert("ABC copiado para a Ã¡rea de transferÃªncia!"))
    .catch(() => alert("Falha ao copiar."));
}
</script>
</body>
</html>
