<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Percep√ß√£o Auditiva ‚Äî Modos e Escalas (ABC) ‚Äî Com Sliders</title>

  <!-- ABCjs (visual) -->
  <script src="https://cdn.jsdelivr.net/npm/abcjs@6.4.2/dist/abcjs-basic-min.js"></script>
  <!-- Tone.js (audio) -->
  <script src="https://cdn.jsdelivr.net/npm/tone@14.8.39/build/Tone.js"></script>

  <style>
    body { font-family: Arial, Helvetica, sans-serif; background:#f7f9fb; padding:18px; max-width:1200px; margin:auto; }
    h1 { text-align:center; color:#222; margin-bottom:6px; }
    .controls { display:flex; gap:16px; flex-wrap:wrap; justify-content:center; margin-bottom:14px; }
    .control { background:#fff; padding:14px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.06); min-width:240px; }
    label strong { display:block; margin-bottom:6px; color:#333; }
    select, button, input[type="number"], input[type="range"] { width:100%; padding:8px; border-radius:8px; border:1px solid #ccc; font-size:14px; box-sizing:border-box; }
    button { cursor:pointer; }
    #paper { margin:16px auto; width:100%; max-width:900px; background:#fff; padding:16px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.06); min-height:80px; }
    #status { text-align:center; margin-top:12px; padding:8px; border-radius:8px; font-weight:700; }
    .status-default { color:#444; background: none; }
    .status-awaiting { color:#0d47a1; background:#e3f2fd; }
    .status-correct { color:#fff; background:#2e7d32; }
    .status-wrong { color:#fff; background:#c62828; }
    .note-buttons { display:flex; gap:10px; justify-content:center; margin-top:16px; flex-wrap:wrap; }
    .note-buttons button { padding:10px 14px; border-radius:8px; border:none; background:#1976d2; color:white; font-weight:700; min-width:56px; }
    .note-buttons button:disabled { background:#cfd8dc; color:#666; cursor:not-allowed; }
    .note-buttons button.correct { background:#2e7d32; }
    .note-buttons button.wrong { background:#c62828; }
    .small { font-size:13px; color:#555; margin-top:8px; }
    .row { display:flex; gap:8px; align-items:center; }
    .row > input[type="number"] { width:120px; flex:0 0 120px; }
    .val { font-weight:700; margin-left:6px; }
    #scoreboard { text-align:center; margin-bottom:10px; font-weight:700; color:#333; }
    #scoreboard span { color:#1976d2; margin:0 6px; }
    .select-actions { display:flex; gap:6px; margin-top:8px; }
    .select-actions button { padding:6px 8px; font-size:13px; background:#efefef; border:1px solid #d0d0d0; cursor:pointer; }
    @media (max-width:900px){ .controls { flex-direction:column; } .control { min-width:auto; } }
  </style>
</head>
<body>
  <h1>üéß Treino de Percep√ß√£o Auditiva ‚Äî Modos e Escalas</h1>

  <div id="scoreboard">Acertos: <span id="correctCount">0</span> / Tentativas: <span id="attemptCount">0</span>
    <button onclick="resetScore()" style="margin-left:8px;padding:6px 10px;background:#c62828;color:white;border:none;border-radius:6px;cursor:pointer;">Limpar Placar</button>
  </div>

  <div class="controls">
    <!-- Notas -->
    <div class="control">
      <label><strong>Notas poss√≠veis (respostas)</strong></label>
      <select id="notas" multiple size="12">
        <option value="C" selected>C</option><option value="C#" selected>C#</option><option value="D" selected>D</option><option value="D#" selected>D#</option>
        <option value="E" selected>E</option><option value="F" selected>F</option><option value="F#" selected>F#</option><option value="G" selected>G</option>
        <option value="G#" selected>G#</option><option value="A" selected>A</option><option value="A#" selected>A#</option><option value="B" selected>B</option>
      </select>
      <div class="select-actions">
        <button id="selAllBtn">Selecionar Todas</button>
        <button id="clearAllBtn">Limpar Sele√ß√£o</button>
      </div>
      <div class="small">Somente notas selecionadas aparecem nos bot√µes de resposta (modo manual).</div>
    </div>

    <!-- Tom / modo / dire√ß√£o / oitava -->
    <div class="control">
      <label><strong>Tom (t√¥nica)</strong></label>
      <select id="tom">
        <option value="C">C</option><option value="C#">C#</option><option value="D">D</option><option value="D#">D#</option>
        <option value="E">E</option><option value="F">F</option><option value="F#">F#</option><option value="G">G</option>
        <option value="G#">G#</option><option value="A">A</option><option value="A#">A#</option><option value="B">B</option>
      </select>

      <label style="margin-top:8px"><strong>Oitava da nota secreta</strong></label>
      <select id="oitava">
        <option value="3">3</option>
        <option value="4" selected>4</option>
        <option value="5">5</option>
      </select>

      <label style="margin-top:8px"><strong>Modo / Escala</strong></label>
      <select id="modo">
        <option value="ionian">J√¥nio (Maior)</option>
        <option value="dorian">D√≥rico</option>
        <option value="phrygian">Fr√≠gio</option>
        <option value="lydian">L√≠dio</option>
        <option value="mixolydian">Mixol√≠dio</option>
        <option value="aeolian">Menor Natural (E√≥lio)</option>
        <option value="harmonic_minor">Menor Harm√¥nica</option>
        <option value="melodic_minor">Menor Mel√≥dica (asc)</option>
        <option value="locrian">L√≥crio</option>
        <option value="chromatic">Crom√°tica</option>
      </select>

      <label style="margin-top:8px"><strong>Dire√ß√£o</strong></label>
      <select id="direcao">
        <option value="asc">Ascendente</option>
        <option value="desc">Descendente</option>
      </select>

    </div>

    <!-- Controles de execu√ß√£o e tempos -->
    <div class="control">
      <label><strong>Controles</strong></label>
      <button id="btnStart" style="background:#2e7d32;color:white;margin-bottom:8px;">‚ñ∂ Iniciar Treino</button>
      <button id="btnStop" style="background:#e53935;color:white;margin-bottom:8px;">‚èπ Parar</button>
      <button id="btnRepeat" style="background:#6a1b9a;color:white;margin-bottom:8px;" disabled>üîÅ Ouvir Nota Novamente</button>
      <button id="btnAuto" style="background:#4caf50;color:white;margin-bottom:8px;">üîÑ Modo Autom√°tico OFF</button>

      <label style="margin-top:8px"><strong>Tocar t√¥nica antes da nota oculta</strong></label>
      <label><input type="checkbox" id="playTonicBefore" checked style="margin-right:8px;">Ativado</label>

      <hr style="margin:10px 0; border:none; border-top:1px solid #eee;">

      <!-- Tempo 1: Nota -> Sequ√™ncia -->
      <label><strong>Tempo (Nota ‚Üí Sequ√™ncia)</strong></label>
      <div class="row">
        <input id="delayBeforeRange" type="range" min="0" max="3000" step="50" value="700">
        <input id="delayBeforeNum" type="number" min="0" max="3000" step="50" value="700">
      </div>

      <!-- Tempo 2: entre notas da sequ√™ncia -->
      <label style="margin-top:8px"><strong>Tempo (entre notas da sequ√™ncia)</strong></label>
      <div class="row">
        <input id="delayBetweenRange" type="range" min="25" max="1500" step="25" value="500">
        <input id="delayBetweenNum" type="number" min="25" max="1500" step="25" value="500">
      </div>

      <!-- Tempo 3: Sequ√™ncia -> Pr√≥xima nota -->
      <label style="margin-top:8px"><strong>Tempo (Sequ√™ncia ‚Üí Pr√≥xima Nota)</strong></label>
      <div class="row">
        <input id="delayAfterRange" type="range" min="0" max="5000" step="50" value="1000">
        <input id="delayAfterNum" type="number" min="0" max="5000" step="50" value="1000">
      </div>
      <div class="small">Voc√™ pode arrastar o slider ou digitar o valor num√©rico ‚Äî ambos sincronizados.</div>
    </div>
  </div>

  <div id="paper"></div>
  <div id="status" class="status-default">Clique em "Iniciar Treino" para come√ßar</div>
  <div class="note-buttons" id="noteButtons"></div>

<script>
/* ============================
   Dados e Configura√ß√µes
   ============================ */
const NOTE_NAMES = ["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];
const MODOS = {
  ionian:        [0,2,4,5,7,9,11],
  dorian:        [0,2,3,5,7,9,10],
  phrygian:      [0,1,3,5,7,8,10],
  lydian:        [0,2,4,6,7,9,11],
  mixolydian:    [0,2,4,5,7,9,10],
  aeolian:       [0,2,3,5,7,8,10],
  harmonic_minor:[0,2,3,5,7,8,11],
  melodic_minor: [0,2,3,5,7,9,11], // ascendente
  locrian:       [0,1,3,5,6,8,10],
  chromatic:     [0,1,2,3,4,5,6,7,8,9,10,11]
};

// Usar apenas o synth para simplificar e garantir que funcione
const synth = new Tone.Synth({
  oscillator: { type: "sine" },
  envelope: { attack: 0.01, decay: 0.1, sustain: 0.3, release: 0.4 }
}).toDestination();

// Inicializar o √°udio
Tone.start();

/* Estado central */
const state = {
  playing: false,
  awaitingGuess: false,
  currentSecretNote: null,
  secretNoteOctave: 4,
  selectedNotes: [],
  keyRoot: "C",
  modoAtual: "ionian",
  direction: "asc",
  playTonic: true,
  autoMode: false,
  score: { correct:0, attempts:0 },
  pendingTimeout: null,
  lastGuess: null
};

/* DOM refs */
const DOM = {
  btnStart: document.getElementById("btnStart"),
  btnStop: document.getElementById("btnStop"),
  btnRepeat: document.getElementById("btnRepeat"),
  btnAuto: document.getElementById("btnAuto"),
  statusEl: document.getElementById("status"),
  noteButtonsDiv: document.getElementById("noteButtons"),
  paperEl: document.getElementById("paper"),
  notasSelect: document.getElementById("notas"),
  tomSelect: document.getElementById("tom"),
  modoSelect: document.getElementById("modo"),
  direcaoSelect: document.getElementById("direcao"),
  oitavaSelect: document.getElementById("oitava"),
  playTonicBefore: document.getElementById("playTonicBefore"),
  correctCount: document.getElementById("correctCount"),
  attemptCount: document.getElementById("attemptCount"),
  // sliders + numeric inputs
  delayBeforeRange: document.getElementById("delayBeforeRange"),
  delayBeforeNum: document.getElementById("delayBeforeNum"),
  delayBetweenRange: document.getElementById("delayBetweenRange"),
  delayBetweenNum: document.getElementById("delayBetweenNum"),
  delayAfterRange: document.getElementById("delayAfterRange"),
  delayAfterNum: document.getElementById("delayAfterNum")
};

/* ============================
   Convers√µes e utilit√°rios musicais
   ============================ */
function letterToScientific(letter, octave){ return letter + octave; }

function midiToScientific(m){ 
  const idx = ((m%12)+12)%12; 
  const oct = Math.floor(m/12)-1; 
  return NOTE_NAMES[idx] + oct; 
}

function scientificToABC(sci){
  const m = sci.match(/^([A-G])(#|b)?(-?\d+)$/);
  if(!m) return sci;
  const letter=m[1], acc=m[2]||"", oct=parseInt(m[3],10);
  const accToken = acc==="#" ? "^" : (acc==="b" ? "_" : "");
  let base;
  if(oct>4){ 
    base = letter.toLowerCase(); 
    if(oct>5) base += "'".repeat(oct-5); 
  } else if(oct<4){ 
    base = letter.toUpperCase() + ",".repeat(4-oct); 
  } else base = letter.toUpperCase();
  return accToken + base;
}

/** Gera a escala em midis com base na t√¥nica + modo, usando a oitava de refer√™ncia */
function generateModeScaleMidi(root, modo, octave){
  const rootIdx = NOTE_NAMES.indexOf(root);
  const tonicMidi = 12*(octave + 1) + rootIdx;
  const pattern = MODOS[modo] || [];
  const midis = pattern.map(i => tonicMidi + i);
  return { midis, tonicMidi };
}

/** Constroi sequ√™ncia a partir da nota secreta e fecha na t√¥nica */
function buildSequenceForSecret(selectedLetter, scaleData, dir){
  const { midis, tonicMidi } = scaleData;
  // Procura por nota equivalente na escala
  let idx = midis.findIndex(m => NOTE_NAMES[m % 12] === selectedLetter);
  if(idx === -1) idx = 0;
  
  if(dir === "asc"){
    const seq = [];
    for(let i = idx; i < midis.length; i++) seq.push(midis[i]);
    let tonicAbove = tonicMidi;
    if(tonicAbove <= seq[seq.length-1]) tonicAbove += 12;
    seq.push(tonicAbove);
    return seq;
  } else {
    const seq = [];
    for(let i = idx; i >= 0; i--) seq.push(midis[i]);
    let tonicBelow = tonicMidi;
    if(tonicBelow >= seq[0]) tonicBelow -= 12;
    seq.push(tonicBelow);
    return seq;
  }
}

/* Convert midis -> ABC string tokens */
function midisToABCTokens(midis){
  return midis.map(m => scientificToABC(midiToScientific(m))).join(" ");
}

function renderABC(tokens, key){
  if(!tokens || tokens.length === 0){ DOM.paperEl.innerHTML = ""; return; }
  const abc = `X:1\nL:1/4\nK:${key}\n${tokens}`;
  ABCJS.renderAbc("paper", abc);
}

/* ============================
   √ÅUDIO: tocar nota
   ============================ */
function playNoteScientific(sci, dur="8n"){
  try {
    synth.triggerAttackRelease(sci, dur);
    return true;
  } catch (error) {
    console.error("Erro ao tocar nota:", sci, error);
    return false;
  }
}

/* Toca sequ√™ncia (array de scientific strings), respeitando delayBetween (ms) */
function playScientificSequence(scientificNotes) {
  return new Promise(async (resolve) => {
    const delayBetween = parseInt(DOM.delayBetweenNum.value, 10);
    
    for(let i = 0; i < scientificNotes.length; i++) {
      if(!state.playing) break;
      
      const note = scientificNotes[i];
      console.log("Tocando nota da sequ√™ncia:", note);
      
      // Tocar a nota
      playNoteScientific(note, "8n");
      
      // Esperar o intervalo entre notas (exceto para a √∫ltima nota)
      if(i < scientificNotes.length - 1) {
        await new Promise(r => setTimeout(r, delayBetween));
      }
    }
    
    resolve();
  });
}

/* Toca nota oculta */
function playHiddenScientific(sci){
  playNoteScientific(sci, "4n");
}

/* ============================
   UI helpers (placar, bot√µes)
   ============================ */
function updateScoreboard(){
  DOM.correctCount.textContent = state.score.correct;
  DOM.attemptCount.textContent = state.score.attempts;
}

function resetScore(){
  state.score = { correct:0, attempts:0 };
  updateScoreboard();
}

/* Atualiza bot√µes de resposta com apenas notas selecionadas */
function updateResponseButtons(){
  const opts = Array.from(DOM.notasSelect.selectedOptions).map(o => o.value);
  DOM.noteButtonsDiv.innerHTML = "";
  if(opts.length === 0){
    DOM.statusEl.textContent = "Selecione notas para aparecerem como bot√µes de resposta.";
    return;
  }
  opts.forEach(n => {
    const b = document.createElement("button");
    b.textContent = n;
    b.dataset.note = n;
    b.onclick = onGuess;
    DOM.noteButtonsDiv.appendChild(b);
  });
  updateUIState();
}

/* Habilita / desabilita elementos conforme estado */
function updateUIState(){
  DOM.btnStart.disabled = state.playing;
  DOM.btnStop.disabled = !state.playing;
  DOM.btnRepeat.disabled = !(state.playing && state.awaitingGuess);
  DOM.btnAuto.textContent = state.autoMode ? "üîÑ Modo Autom√°tico ON" : "üîÑ Modo Autom√°tico OFF";
  
  const configDisabled = state.playing;
  DOM.notasSelect.disabled = configDisabled;
  DOM.tomSelect.disabled = configDisabled;
  DOM.modoSelect.disabled = configDisabled;
  DOM.direcaoSelect.disabled = configDisabled;
  DOM.oitavaSelect.disabled = configDisabled;
  DOM.playTonicBefore.disabled = configDisabled;
  
  const answerButtons = DOM.noteButtonsDiv.querySelectorAll("button");
  answerButtons.forEach(b => { 
    b.disabled = !state.awaitingGuess;
    if (state.awaitingGuess) {
      b.classList.remove("correct", "wrong");
    }
  });
}

/* ============================
   Fluxo principal
   ============================ */

async function startRound(){
  if(state.playing) return;
  const selOpts = Array.from(DOM.notasSelect.selectedOptions);
  if(selOpts.length === 0){ 
    alert("Selecione pelo menos uma nota!"); 
    return; 
  }
  
  state.playing = true;
  state.selectedNotes = selOpts.map(o => o.value);
  state.keyRoot = DOM.tomSelect.value;
  state.modoAtual = DOM.modoSelect.value;
  state.direction = DOM.direcaoSelect.value;
  state.secretNoteOctave = parseInt(DOM.oitavaSelect.value, 10);
  state.playTonic = DOM.playTonicBefore.checked;
  
  DOM.paperEl.innerHTML = "";
  DOM.statusEl.textContent = "Treino ativo ‚Äî tocando nota oculta...";
  DOM.statusEl.className = "status-awaiting";
  updateUIState();
  
  await playNextNote();
}

function stopAll(){
  state.playing = false;
  state.awaitingGuess = false;
  state.currentSecretNote = null;
  if(state.pendingTimeout) { 
    clearTimeout(state.pendingTimeout); 
    state.pendingTimeout = null; 
  }
  DOM.paperEl.innerHTML = "";
  DOM.statusEl.textContent = "Parado.";
  DOM.statusEl.className = "status-default";
  updateUIState();
}

async function playNextNote() {
  if(!state.playing) return;
  
  state.currentSecretNote = state.selectedNotes[Math.floor(Math.random() * state.selectedNotes.length)];
  state.awaitingGuess = true;
  state.lastGuess = null;
  
  DOM.statusEl.textContent = "üéß Ou√ßa a nota oculta (n√£o aparece). Clique na nota que acha que foi.";
  DOM.statusEl.className = "status-awaiting";
  DOM.paperEl.innerHTML = "";

  // Limpar cores dos bot√µes
  const allButtons = DOM.noteButtonsDiv.querySelectorAll("button");
  allButtons.forEach(btn => {
    btn.classList.remove("correct", "wrong");
  });

  // Pequeno delay antes de tocar
  await new Promise(r => setTimeout(r, 100));

  // tocar t√¥nica antes se ativado
  if(state.playTonic){
    const keyRootMidi = 12 * (state.secretNoteOctave + 1) + NOTE_NAMES.indexOf(state.keyRoot);
    const keyRootSci = midiToScientific(keyRootMidi);
    playNoteScientific(keyRootSci, "4n");
    await new Promise(r => setTimeout(r, 800)); // Delay maior ap√≥s a t√¥nica
  }

  // tocar a nota secreta
  const secretSci = letterToScientific(state.currentSecretNote, state.secretNoteOctave);
  playHiddenScientific(secretSci);

  updateUIState();
}

/* repetir nota oculta */
function repeatNote(){
  if(!state.awaitingGuess || !state.currentSecretNote){ 
    DOM.statusEl.textContent = "Nenhuma nota ativa para repetir."; 
    return; 
  }
  const sci = letterToScientific(state.currentSecretNote, state.secretNoteOctave);
  playHiddenScientific(sci);
}

/* quando usu√°rio clica em uma nota (tenta adivinhar) */
async function onGuess(e){
  if(!state.awaitingGuess || !state.playing) return;
  
  const guessed = e.currentTarget.dataset.note;
  state.awaitingGuess = false;
  state.lastGuess = guessed;
  state.score.attempts++;
  updateScoreboard();
  updateUIState();

  // Destacar o bot√£o clicado e a resposta correta
  const allButtons = DOM.noteButtonsDiv.querySelectorAll("button");
  allButtons.forEach(btn => {
    if(btn.dataset.note === guessed) {
      btn.classList.add(guessed === state.currentSecretNote ? "correct" : "wrong");
    }
    if(btn.dataset.note === state.currentSecretNote && guessed !== state.currentSecretNote) {
      btn.classList.add("correct");
    }
  });

  const delayBefore = parseInt(DOM.delayBeforeNum.value, 10) || 0;
  const delayAfter = parseInt(DOM.delayAfterNum.value, 10) || 0;

  // determinar comportamento melodic_minor descendente -> usar aeolian para descida:
  let modeToGenerate = state.modoAtual;
  if(state.modoAtual === "melodic_minor" && state.direction === "desc") modeToGenerate = "aeolian";

  // gerar escala
  const scaleData = generateModeScaleMidi(state.keyRoot, modeToGenerate, state.secretNoteOctave);
  const seqMidis = buildSequenceForSecret(state.currentSecretNote, scaleData, state.direction);
  const scientificSeq = seqMidis.map(m => midiToScientific(m));
  const abcTokens = midisToABCTokens(seqMidis);

  DOM.paperEl.innerHTML = "";
  renderABC(abcTokens, state.keyRoot);

  if(guessed === state.currentSecretNote){
    // acerto
    state.score.correct++;
    updateScoreboard();
    DOM.statusEl.textContent = "‚úÖ Acertou! Preparando para tocar a sequ√™ncia...";
    DOM.statusEl.className = "status-correct";
    
    // Espera antes da sequ√™ncia
    if(delayBefore > 0) {
      await new Promise(r => setTimeout(r, delayBefore));
    }
    
    // Toca a sequ√™ncia
    if(state.playing) {
      DOM.statusEl.textContent = "üéµ Tocando sequ√™ncia...";
      await playScientificSequence(scientificSeq);
    }
    
    if(state.pendingTimeout) { 
      clearTimeout(state.pendingTimeout); 
      state.pendingTimeout = null; 
    }
    
    // Avan√ßar para pr√≥xima nota ap√≥s delay
    if(state.playing) {
      state.pendingTimeout = setTimeout(async () => {
        state.pendingTimeout = null;
        if(state.playing) {
          await playNextNote();
        }
      }, delayAfter);
    }
    
  } else {
    // erro
    DOM.statusEl.textContent = `‚ùå Errado ‚Äî a nota correta era ${state.currentSecretNote}.`;
    DOM.statusEl.className = "status-wrong";
    
    if(state.pendingTimeout) { 
      clearTimeout(state.pendingTimeout); 
      state.pendingTimeout = null; 
    }
    
    // No caso de erro, avan√ßar para a pr√≥xima nota ap√≥s delay
    if(state.playing) {
      state.pendingTimeout = setTimeout(async () => {
        state.pendingTimeout = null;
        if(state.playing) {
          await playNextNote();
        }
      }, 2000);
    }
  }
}

/* ============================
   Eventos
   ============================ */

/* Bot√µes principais */
DOM.btnStart.addEventListener("click", startRound);
DOM.btnStop.addEventListener("click", stopAll);
DOM.btnRepeat.addEventListener("click", repeatNote);
DOM.btnAuto.addEventListener("click", () => {
  state.autoMode = !state.autoMode;
  DOM.btnAuto.textContent = state.autoMode ? "üîÑ Modo Autom√°tico ON" : "üîÑ Modo Autom√°tico OFF";
  if(state.autoMode && state.playing && !state.awaitingGuess){
    playNextNote();
  }
  updateUIState();
});

/* Select all / clear all notes */
document.getElementById("selAllBtn").addEventListener("click", () => {
  Array.from(DOM.notasSelect.options).forEach(o => o.selected = true);
  updateResponseButtons();
});
document.getElementById("clearAllBtn").addEventListener("click", () => {
  Array.from(DOM.notasSelect.options).forEach(o => o.selected = false);
  updateResponseButtons();
});

/* Update response buttons when selection changes */
DOM.notasSelect.addEventListener("change", updateResponseButtons);

/* Sliders + Numeric inputs sync */ 
function syncRangeAndNum(rangeEl, numEl){
  rangeEl.addEventListener("input", () => {
    numEl.value = rangeEl.value;
  });
  numEl.addEventListener("input", () => {
    let v = parseInt(numEl.value, 10);
    if(isNaN(v)) v = parseInt(rangeEl.min,10);
    v = Math.max(parseInt(rangeEl.min,10), Math.min(parseInt(rangeEl.max,10), v));
    numEl.value = v;
    rangeEl.value = v;
  });
}

syncRangeAndNum(DOM.delayBeforeRange, DOM.delayBeforeNum);
syncRangeAndNum(DOM.delayBetweenRange, DOM.delayBetweenNum);
syncRangeAndNum(DOM.delayAfterRange, DOM.delayAfterNum);

/* Start UI initial state */
document.addEventListener("DOMContentLoaded", () => {
  updateResponseButtons();
  updateScoreboard();
  updateUIState();
});

</script> 
</body>
</html>