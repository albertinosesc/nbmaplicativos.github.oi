<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Biblioteca Musical Digital Avan√ßada</title>
<style>
/* ===== Layout geral ===== */
body { font-family: Arial, sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }

/* ===== Header ===== */
header {
  width: 100%;
  padding: 10px 20px;
  background-color: #0056b3;
  color: white;
  font-size: 28px;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: flex-start; /* Alinha conte√∫do √† esquerda */
  gap: 50px; /* Espa√ßo entre bot√£o e t√≠tulo */
}

/* Bot√£o de toggle do menu */
#toggleMenu {
  font-size: 17px;
  cursor: pointer;
  background: white;
  color: #0056b3;
  border: none;
  padding: 5px 10px;
  border-radius: 4px;
}

/* ===== √Årea de conte√∫do ===== */
.main-content { flex-grow: 1; display: flex; height: 100%; transition: all 0.3s ease; }

/* ===== Menu lateral ===== */
nav { width: 320px; padding: 10px; border-right: 1px solid #ccc; overflow-y: auto; background-color: #f8f8f8; transition: all 0.3s ease; }
nav.hidden { width: 0; padding: 0; overflow: hidden; }

/* ===== Menu e itens ===== */
nav input { width: 100%; padding: 5px; margin-bottom: 10px; box-sizing: border-box; }
nav ul { list-style: none; padding-left: 0; }
nav li { padding: 5px; cursor: pointer; border-bottom: 1px dashed #eee; transition: background 0.2s; display: flex; align-items: center; }
nav li:hover, .active { background-color: #e0e0ff; }
.collapsible { font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: space-between; }
.submenu { display: none; padding-left: 20px; }

/* ===== √çcones ===== */
.icon-cat::before { content: "üéµ"; margin-right: 6px; }
.icon-sub::before { content: "üìÇ"; margin-right: 6px; }
.icon-file::before { content: "üé∂"; margin-right: 6px; }

/* ===== Setinha ===== */
.collapsible::after { content: "‚ñ∂"; font-size: 12px; margin-left: 6px; transition: transform 0.2s; }
.collapsible.expanded::after { transform: rotate(90deg); }

/* ===== Iframe ===== */
#iframeConteudo { flex-grow: 1; border: none; transition: all 0.3s ease; }

/* ===== √Çncoras ===== */
.anchor-highlight { animation: highlightFade 1.5s ease-out; border-left: 4px solid #4CAF50 !important; padding-left: 10px !important; }
@keyframes highlightFade { 0%,70% { background-color: #ffffcc; } 100% { background-color: transparent; } }
.anchor-status { position: fixed; bottom: 10px; right: 10px; background: #4CAF50; color: white; padding: 5px 10px; border-radius: 4px; font-size: 12px; z-index: 1000; opacity: 0.8; }
</style>
</head>
<body>

<header>
<button id="toggleMenu">‚ò∞ Menu</button>
  Biblioteca NBM
  
</header>

<div class="main-content">
  <nav id="sidebar">
    <input type="text" id="searchInput" placeholder="Buscar por nome ou tag...">
    <div id="menu"></div>
  </nav>

  <iframe id="iframeConteudo"></iframe>
</div>

<script>
let allFiles = [];
let activeListItem = null;
const iframe = document.getElementById('iframeConteudo');
const sidebar = document.getElementById('sidebar');
const toggleButton = document.getElementById('toggleMenu');

// ------------------ Toggle menu lateral ------------------
toggleButton.addEventListener('click', () => {
  sidebar.classList.toggle('hidden');
});

// ------------------ Gerar menu ------------------
function gerarMenu(data) {
  const menu = document.getElementById('menu');
  menu.innerHTML = '';

  for (const cat in data) {
    const catLi = document.createElement('div');
    catLi.innerHTML = `<span class="icon-cat"></span>${cat}`;
    catLi.className = 'collapsible';
    menu.appendChild(catLi);

    const subMenu = document.createElement('div');
    subMenu.className = 'submenu';

    const subcats = data[cat];
    for (const sub in subcats) {
      const subLi = document.createElement('div');
      subLi.innerHTML = `<span class="icon-sub"></span>${sub}`;
      subLi.className = 'collapsible';
      subMenu.appendChild(subLi);

      const subSubMenu = document.createElement('ul');
      subcats[sub].forEach(fileObj => {
        const li = document.createElement('li');
        const nome = fileObj.arquivo.split('/').pop().replace('.html','').replace(/-/g,' ');
        li.textContent = nome;
        li.dataset.file = fileObj.arquivo;
        li.dataset.tags = fileObj.tags.join(',');
        li.classList.add('icon-file');
        li.onclick = () => carregarArquivo(fileObj.arquivo, li);
        subSubMenu.appendChild(li);

        allFiles.push(li);
      });
      subMenu.appendChild(subSubMenu);

      subLi.onclick = () => {
        subSubMenu.style.display = subSubMenu.style.display === 'block' ? 'none' : 'block';
        subLi.classList.toggle('expanded');
      };
    }
    menu.appendChild(subMenu);

    catLi.onclick = () => {
      subMenu.style.display = subMenu.style.display === 'block' ? 'none' : 'block';
      catLi.classList.toggle('expanded');
    };
  }
}

// ------------------ Carregar arquivo ------------------
function carregarArquivo(url, li) {
  if (activeListItem) activeListItem.classList.remove('active');
  li.classList.add('active');
  activeListItem = li;

  fetch(url)
    .then(res => res.text())
    .then(html => {
      iframe.srcdoc = html;
      setTimeout(() => injetarScriptDeAncoras(), 500);
    })
    .catch(err => console.error('Erro ao carregar arquivo:', err));
}

// ------------------ Busca ------------------
document.getElementById('searchInput').addEventListener('input', e => {
  const termo = e.target.value.toLowerCase();
  allFiles.forEach(li => {
    const texto = li.textContent.toLowerCase();
    const tags = li.dataset.tags ? li.dataset.tags.toLowerCase() : '';
    li.style.display = (texto.includes(termo) || tags.includes(termo)) ? 'block' : 'none';
  });
});

// ------------------ √Çncoras ------------------
function injetarScriptDeAncoras() {
  if (!iframe.contentDocument) return;

  iframe.contentDocument.querySelectorAll('script[data-anchor]').forEach(s => s.remove());

  const script = document.createElement('script');
  script.dataset.anchor = "true";
  script.textContent = `
    (function() {
      if (window.__anchorFixApplied) return;
      window.__anchorFixApplied = true;
      let lastTarget = null;

      document.addEventListener('click', e => {
        let target = e.target;
        while(target && target.tagName !== 'A' && target !== document.body) target = target.parentElement;
        if(target && target.tagName === 'A' && target.hash && target.hash !== '#') {
          const id = target.hash.substring(1);
          const el = document.getElementById(id);
          if(el) {
            e.preventDefault();
            if(lastTarget) lastTarget.classList.remove('anchor-highlight');
            el.classList.add('anchor-highlight');
            lastTarget = el;
            el.scrollIntoView({behavior:'smooth', block:'start'});
            setTimeout(()=>el.classList.remove('anchor-highlight'),1500);
          }
        }
      });
    })();
  `;
  iframe.contentDocument.head.appendChild(script);
}

// ------------------ Inicializar ------------------
fetch('menu.json')
  .then(res => res.json())
  .then(data => gerarMenu(data))
  .catch(err => console.error('Erro ao carregar menu JSON:', err));
</script>

</body>
</html>
