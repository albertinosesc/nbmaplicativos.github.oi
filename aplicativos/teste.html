<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de Partituras ABC</title>
    <script src="https://cdn.jsdelivr.net/npm/abcjs@6.2.3/dist/abcjs-min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        header {
            background: #2c3e50;
            color: white;
            padding: 25px;
            text-align: center;
        }
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        .description {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }
        .content {
            display: flex;
            flex-direction: column;
            padding: 25px;
        }
        .input-area {
            margin-bottom: 25px;
        }
        textarea {
            width: 100%;
            height: 150px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: monospace;
            font-size: 16px;
            resize: vertical;
            transition: border-color 0.3s;
        }
        textarea:focus {
            outline: none;
            border-color: #3498db;
        }
        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        #render-btn {
            background: #2ecc71;
            color: white;
            flex: 2;
        }
        #render-btn:hover {
            background: #27ae60;
        }
        #normalize-btn {
            background: #3498db;
            color: white;
            flex: 1;
        }
        #normalize-btn:hover {
            background: #2980b9;
        }
        .output-area {
            border: 2px solid #eee;
            border-radius: 8px;
            padding: 20px;
            min-height: 400px;
            background: #fafafa;
        }
        .examples {
            margin-top: 30px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
        }
        .examples h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .example-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }
        .example {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            cursor: pointer;
            transition: transform 0.3s;
        }
        .example:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        .example h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .example pre {
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 14px;
            color: #7f8c8d;
        }
        .instructions {
            background: #e8f4fc;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }
        .instructions h3 {
            color: #2980b9;
            margin-bottom: 15px;
        }
        .instructions ul {
            padding-left: 20px;
        }
        .instructions li {
            margin-bottom: 10px;
        }
        footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        @media (max-width: 768px) {
            .buttons {
                flex-direction: column;
            }
            .example-list {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Visualizador de Partituras ABC</h1>
            <p class="description">Digite ou cole sua notação ABC abaixo para visualizar a partitura</p>
        </header>

        <div class="content">
            <div class="input-area">
                <textarea id="abc-input" placeholder="Cole sua notação ABC aqui...">X:1
T:Exemplo de Música
M:4/4
L:1/4
K:C
C D E F | G A B c |</textarea>
                
                <div class="buttons">
                    <button id="render-btn">Visualizar Partitura</button>
                    <button id="normalize-btn">Normalizar Notas</button>
                </div>
            </div>

            <div class="output-area" id="paper">
                <p style="text-align: center; color: #7f8c8d; padding: 30px;">
                    Sua partitura será exibida aqui após clicar em "Visualizar Partitura"
                </p>
            </div>

            <div class="examples">
                <h3>Exemplos de Notação ABC</h3>
                <div class="example-list">
                    <div class="example" onclick="loadExample(1)">
                        <h4>Escala de Dó Maior</h4>
                        <pre>X:1
T:Escala de Dó Maior
M:4/4
L:1/4
K:C
C D E F | G A B c |</pre>
                    </div>
                    <div class="example" onclick="loadExample(2)">
                        <h4>Twinkle Twinkle Little Star</h4>
                        <pre>X:1
T:Twinkle Twinkle Little Star
M:4/4
L:1/4
K:C
C C G G | A A G2 | F F E E | D D C2 |</pre>
                    </div>
                    <div class="example" onclick="loadExample(3)">
                        <h4>Canção Folclórica</h4>
                        <pre>X:1
T:Canção Folclórica
M:3/4
L:1/4
K:G
G G G | D D D | E E E | D4 |</pre>
                    </div>
                </div>
            </div>

            <div class="instructions">
                <h3>Como usar a notação ABC</h3>
                <ul>
                    <li><strong>X:</strong> Número de referência da música</li>
                    <li><strong>T:</strong> Título da música</li>
                    <li><strong>M:</strong> Compasso (ex: 4/4, 3/4, 6/8)</li>
                    <li><strong>L:</strong> Unidade de duração padrão (ex: 1/4, 1/8)</li>
                    <li><strong>K:</strong> Clave (ex: C para Dó maior, G para Sol maior)</li>
                    <li>Use letras de A a G para notas, números para durações e | para separar compassos</li>
                </ul>
            </div>
        </div>

        <footer>
            <p>Visualizador de Partituras ABC &copy; 2023</p>
        </footer>
    </div>

    <script>
        // Elementos da UI
        const abcInput = document.getElementById('abc-input');
        const renderBtn = document.getElementById('render-btn');
        const normalizeBtn = document.getElementById('normalize-btn');
        const paper = document.getElementById('paper');

        // Renderizar a partitura
        function render() {
            const abc = abcInput.value;
            
            // Limpa o conteúdo anterior
            paper.innerHTML = '';
            
            try {
                // Renderiza a partitura
                ABCJS.renderAbc('paper', abc, {
                    responsive: 'resize',
                    staffwidth: 700,
                    paddingtop: 10,
                    paddingbottom: 10,
                    paddingleft: 5,
                    paddingright: 5
                });
            } catch (error) {
                paper.innerHTML = `
                    <div style="color: #e74c3c; text-align: center; padding: 20px;">
                        <h3>Erro ao renderizar a partitura</h3>
                        <p>Verifique se a notação ABC está correta</p>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // Normalizar as notas (função original preservada)
        function normalizar() {
            let abc = abcInput.value;

            // Divide cabeçalho e corpo da música
            let partes = abc.split(/(K:[^\n]*\n)/);
            if (partes.length < 3) {
                alert("Não foi encontrado o campo K:");
                return;
            }

            let cabecalho = partes[0] + partes[1];
            let corpo = partes.slice(2).join("");

            // Remove pausas
            corpo = corpo.replace(/\b[zxZX][0-9\/><\.]*\b/g, "");

            // Substitui notas com duração/símbolos → Nota0
            corpo = corpo.replace(/([A-Ga-g][,']*)([0-9\/><\.]+)/g, "$10");

            // Notas sem nada → adiciona 0
            corpo = corpo.replace(/([A-Ga-g][,']*)(?!0)/g, "$10");

            // Limpeza extra
            corpo = corpo.replace(/\s+/g, " ").trim();

            let finalizado = cabecalho + corpo;
            abcInput.value = finalizado;
            render();
        }

        // Carregar exemplos
        function loadExample(num) {
            const examples = [
                `X:1
T:Escala de Dó Maior
M:4/4
L:1/4
K:C
C D E F | G A B c |`,
                `X:1
T:Twinkle Twinkle Little Star
M:4/4
L:1/4
K:C
C C G G | A A G2 | F F E E | D D C2 |`,
                `X:1
T:Canção Folclórica
M:3/4
L:1/4
K:G
G G G | D D D | E E E | D4 |`
            ];
            
            abcInput.value = examples[num - 1];
            render();
        }

        // Event Listeners
        renderBtn.addEventListener('click', render);
        normalizeBtn.addEventListener('click', normalizar);

        // Renderizar a partitura inicial ao carregar a página
        window.addEventListener('load', render);
    </script>
</body>
</html>
