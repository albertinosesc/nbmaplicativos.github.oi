<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acordes Violão - Catálogo Completo</title>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        header {
            background-color: #333;
            color: white;
            padding: 10px 0;
            text-align: center;
        }
        main {
            max-width: 900px;
            margin: 20px auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        .controls label {
            margin-right: 10px;
        }
        .controls select, .controls button {
            padding: 8px;
            margin-right: 15px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        .controls button {
            background-color: #007bff;
            color: white;
            cursor: pointer;
            border: none;
        }
        .controls button:hover {
            background-color: #0056b3;
        }
        #detalhesAcordeCompleto {
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 4px;
            background-color: #f9f9f9;
            margin-top: 15px;
        }
        #detalhesAcordeCompleto h3 {
            margin-top: 0;
            color: #007bff;
        }
        #detalhesAcordeCompleto code {
            background-color: #e9e9e9;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: monospace;
        }
        .table-container {
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table th, table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        table td.header-cell {
            background-color: #f2f2f2;
            font-weight: bold;
            text-align: left;
        }
        .acorde-lookup-area {
            margin-top: 30px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        footer {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            color: #777;
            font-size: 0.9em;
        }
        #diagramaAcordeContainer {
            margin: 20px 0;
            padding: 10px;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .diagrama-titulo {
            text-align: center;
            font-weight: bold;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <header>
        <h1>Catálogo de Acordes de Violão12</h1>
    </header>

    <main>
        <section class="acorde-lookup-area">
            <h2>Buscar Acorde Completo (Tabela 2)</h2>
            <div class="controls">
                <label for="tomAcordeLookup">Tom:</label>
                <select id="tomAcordeLookup"></select>

                <label for="qualidadeAcordeLookup">Qualidade:</label>
                <select id="qualidadeAcordeLookup"></select>

                <label for="formaAcordeLookup">Forma CAGEDF:</label>
                <select id="formaAcordeLookup"></select>

                <button id="buscarAcordeCompleto">Buscar Acorde</button>
            </div>
            <div id="detalhesAcordeCompleto">
                <p>Selecione um tom, qualidade e forma para ver os detalhes do acorde.</p>
                <div id="diagramaAcordeContainer"></div>
            </div>
        </section>

        <section class="table-area">
            <h2>Tabela de IDs de Desenho (CAGEDF x Qualidade)</h2>
            <div class="table-container">
                <table id="tabelaDesenhosIDs">
                    <thead>
                        <tr>
                            <th>Qualidade \ Forma</th>
                            <th>C</th>
                            <th>A</th>
                            <th>G</th>
                            <th>E</th>
                            <th>D</th>
                            <th>F</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 Seu Sistema de Acordes</p>
    </footer>

    <script>
        // Estrutura de Dados para os Desenhos de Acorde
        const desenhosAcordes = [
            // Maior (IDs 1-6)
            {
                id: 1,
                qualidade: "Maior",
                forma_cagedf: "C",
                desenho_string: "x32010",
                notas_base: ["C", "E", "G"],
                intervalos: ["1", "3M", "5J"],
                dicas: "Dedo 3 na 5ª corda (casa 3), Dedo 2 na 4ª corda (casa 2), Dedo 1 na 2ª corda (casa 1). Não tocar a 6ª corda.",
                casa_pestana_base: 0
            },
            {
                id: 2,
                qualidade: "Maior",
                forma_cagedf: "A",
                desenho_string: "x02220",
                notas_base: ["A", "C#", "E"],
                intervalos: ["1", "3M", "5J"],
                dicas: "Cuidado para não abafar a 1ª corda. Dedo 2, 3 e 4 nas cordas 4, 3 e 2 na casa 2.",
                casa_pestana_base: 0
            },
            {
                id: 3,
                qualidade: "Maior",
                forma_cagedf: "G",
                desenho_string: "320003",
                notas_base: ["G", "B", "D"],
                intervalos: ["1", "3M", "5J"],
                dicas: "Formato padrão e versátil. Dedo 3 na 6ª corda (casa 3), Dedo 2 na 5ª corda (casa 2), Dedo 4 na 1ª corda (casa 3).",
                casa_pestana_base: 0
            },
            {
                id: 4,
                qualidade: "Maior",
                forma_cagedf: "E",
                desenho_string: "022100",
                notas_base: ["E", "G#", "B"],
                intervalos: ["1", "3M", "5J"],
                dicas: "Forma básica para pestanas. Dedo 2 na 5ª corda (casa 2), Dedo 3 na 4ª corda (casa 2), Dedo 1 na 3ª corda (casa 1).",
                casa_pestana_base: 0
            },
            {
                id: 5,
                qualidade: "Maior",
                forma_cagedf: "D",
                desenho_string: "xx0232",
                notas_base: ["D", "F#", "A"],
                intervalos: ["1", "3M", "5J"],
                dicas: "Não tocar cordas 5 e 6. Dedo 1 na 3ª corda (casa 2), Dedo 3 na 2ª corda (casa 3), Dedo 2 na 1ª corda (casa 2).",
                casa_pestana_base: 0
            },
            {
                id: 6,
                qualidade: "Maior",
                forma_cagedf: "F",
                desenho_string: "133211",
                notas_base: ["F", "A", "C"],
                intervalos: ["1", "3M", "5J"],
                dicas: "Pestana na casa 1. Dedo 1 faz pestana, dedo 2 na 3ª corda casa 2, dedo 3 na 5ª corda casa 3, dedo 4 na 4ª corda casa 3.",
                casa_pestana_base: 1
            },

            // Menor (IDs 7-12)
            {
                id: 7,
                qualidade: "Menor",
                forma_cagedf: "C",
                desenho_string: "x35543",
                notas_base: ["C", "Eb", "G"],
                intervalos: ["1", "3m", "5J"],
                dicas: "Pestana com dedo 1 na casa 3 (corda 5). Formato da forma Am.",
                casa_pestana_base: 3
            },
            {
                id: 8,
                qualidade: "Menor",
                forma_cagedf: "A",
                desenho_string: "x02210",
                notas_base: ["A", "C", "E"],
                intervalos: ["1", "3m", "5J"],
                dicas: "Cuidado para não abafar a 1ª corda. Dedo 2 na 4ª corda (casa 2), Dedo 3 na 3ª corda (casa 2), Dedo 1 na 2ª corda (casa 1).",
                casa_pestana_base: 0
            },
            {
                id: 9,
                qualidade: "Menor",
                forma_cagedf: "G",
                desenho_string: "355333",
                notas_base: ["G", "Bb", "D"],
                intervalos: ["1", "3m", "5J"],
                dicas: "Pestana na casa 3. Formato da forma Em.",
                casa_pestana_base: 3
            },
            {
                id: 10,
                qualidade: "Menor",
                forma_cagedf: "E",
                desenho_string: "022000",
                notas_base: ["E", "G", "B"],
                intervalos: ["1", "3m", "5J"],
                dicas: "Dedo 2 na 5ª corda (casa 2), Dedo 3 na 4ª corda (casa 2). Cordas 1, 2, 3 e 6 soltas.",
                casa_pestana_base: 0
            },
            {
                id: 11,
                qualidade: "Menor",
                forma_cagedf: "D",
                desenho_string: "xx0231",
                notas_base: ["D", "F", "A"],
                intervalos: ["1", "3m", "5J"],
                dicas: "Não tocar cordas 5 e 6. Dedo 1 na 1ª corda (casa 1), Dedo 2 na 3ª corda (casa 2), Dedo 3 na 2ª corda (casa 3).",
                casa_pestana_base: 0
            },
            {
                id: 12,
                qualidade: "Menor",
                forma_cagedf: "F",
                desenho_string: "133111",
                notas_base: ["F", "Ab", "C"],
                intervalos: ["1", "3m", "5J"],
                dicas: "Pestana na casa 1. Dedo 1 faz pestana, dedo 2 na 3ª corda casa 2, dedo 3 na 5ª corda casa 3, dedo 4 na 4ª corda casa 3.",
                casa_pestana_base: 1
            },

            // Diminuto (IDs 13-18)
            {
                id: 13,
                qualidade: "Diminuto",
                forma_cagedf: "C",
                desenho_string: "x3454x",
                notas_base: ["C", "Eb", "Gb"],
                intervalos: ["1", "3m", "5d"],
                dicas: "Pestana com dedo 1 na casa 3 (corda 5) e dedo 4 na casa 5 (corda 4). Difícil.",
                casa_pestana_base: 3
            },
            {
                id: 14,
                qualidade: "Diminuto",
                forma_cagedf: "A",
                desenho_string: "x0121x",
                notas_base: ["A", "C", "Eb"],
                intervalos: ["1", "3m", "5d"],
                dicas: "Dedo 1 na 3ª corda (casa 1). Difícil de soar limpo.",
                casa_pestana_base: 0
            },
            {
                id: 15,
                qualidade: "Diminuto",
                forma_cagedf: "G",
                desenho_string: "345353",
                notas_base: ["G", "Bb", "Db"],
                intervalos: ["1", "3m", "5d"],
                dicas: "Pestana com dedo 1 na casa 3. Difícil pela forma Em diminuta.",
                casa_pestana_base: 3
            },
            {
                id: 16,
                qualidade: "Diminuto",
                forma_cagedf: "E",
                desenho_string: "x2323x",
                notas_base: ["E", "G", "Bb"],
                intervalos: ["1", "3m", "5d"],
                dicas: "Dedo 2 na 5ª corda (casa 2), dedo 3 na 4ª corda (casa 3), dedo 1 na 3ª corda (casa 2).",
                casa_pestana_base: 0
            },
            {
                id: 17,
                qualidade: "Diminuto",
                forma_cagedf: "D",
                desenho_string: "xx0131",
                notas_base: ["D", "F", "Ab"],
                intervalos: ["1", "3m", "5d"],
                dicas: "Não tocar cordas 5 e 6. Dedo 1 na 3ª corda (casa 1), Dedo 3 na 2ª corda (casa 3), Dedo 1 na 1ª corda (casa 1).",
                casa_pestana_base: 0
            },
            {
                id: 18,
                qualidade: "Diminuto",
                forma_cagedf: "F",
                desenho_string: "134242",
                notas_base: ["F", "Ab", "B"],
                intervalos: ["1", "3m", "5d"],
                dicas: "Pestana na casa 1. Dedo 1 faz pestana, dedo 2 na 3ª corda casa 3, dedo 3 na 5ª corda casa 4, dedo 4 na 4ª corda casa 2.",
                casa_pestana_base: 1
            },

            // Aumentado (IDs 19-24)
            {
                id: 19,
                qualidade: "Aumentado",
                forma_cagedf: "C",
                desenho_string: "x32110",
                notas_base: ["C", "E", "G#"],
                intervalos: ["1", "3M", "5a"],
                dicas: "Dedo 1 na 2ª corda (casa 1), Dedo 2 na 4ª corda (casa 2), Dedo 3 na 5ª corda (casa 3).",
                casa_pestana_base: 0
            },
            {
                id: 20,
                qualidade: "Aumentado",
                forma_cagedf: "A",
                desenho_string: "x02110",
                notas_base: ["A", "C#", "F"],
                intervalos: ["1", "3M", "5a"],
                dicas: "Similar ao A maior, mas com a 3ª corda na casa 1. Cuidado para não abafar.",
                casa_pestana_base: 0
            },
            {
                id: 21,
                qualidade: "Aumentado",
                forma_cagedf: "G",
                desenho_string: "321000",
                notas_base: ["G", "B", "D#"],
                intervalos: ["1", "3M", "5a"],
                dicas: "Dedo 1 na 3ª corda (casa 1), Dedo 2 na 5ª corda (casa 2), Dedo 3 na 6ª corda (casa 3).",
                casa_pestana_base: 0
            },
            {
                id: 22,
                qualidade: "Aumentado",
                forma_cagedf: "E",
                desenho_string: "02110x",
                notas_base: ["E", "G#", "C"],
                intervalos: ["1", "3M", "5a"],
                dicas: "Não tocar a 1ª corda. Dedo 1 na 3ª corda (casa 1), Dedo 2 na 5ª corda (casa 2), Dedo 3 na 4ª corda (casa 1).",
                casa_pestana_base: 0
            },
            {
                id: 23,
                qualidade: "Aumentado",
                forma_cagedf: "D",
                desenho_string: "xx0332",
                notas_base: ["D", "F#", "A#"],
                intervalos: ["1", "3M", "5a"],
                dicas: "Não tocar cordas 5 e 6. Dedo 1 na 1ª corda (casa 2), Dedo 2 e 3 na 2ª e 3ª cordas (casa 3).",
                casa_pestana_base: 0
            },
            {
                id: 24,
                qualidade: "Aumentado",
                forma_cagedf: "F",
                desenho_string: "133211",
                notas_base: ["F", "A", "C#"],
                intervalos: ["1", "3M", "5a"],
                dicas: "Pestana na casa 1. Dedo 1 faz pestana, dedo 2 na 3ª corda casa 2, dedo 3 na 5ª corda casa 3, dedo 4 na 4ª corda casa 3.",
                casa_pestana_base: 1
            }
        ];

        // Listas de referência para mapeamento e seleção
        const QUALIDADES_ORDEM = ["Maior", "Menor", "Diminuto", "Aumentado"];
        const FORMAS_CAGEDF_ORDEM = ["C", "A", "G", "E", "D", "F"];

        // Constantes musicais para transposição de notas
        const NOTAS_CROMATICAS = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];
        const QUALIDADE_SUFIXOS = {
            "Maior": "",
            "Menor": "m",
            "Diminuto": "dim",
            "Aumentado": "aug",
        };

        // Notas raiz de cada forma CAGEDF quando tocada na posição aberta
        const FORMAS_CAGEDF_RAIZ = {
            "C": "C",
            "A": "A",
            "G": "G",
            "E": "E",
            "D": "D",
            "F": "F" 
        };

        // Elementos HTML
        const selectTomAcordeLookup = document.getElementById("tomAcordeLookup");
        const selectQualidadeAcordeLookup = document.getElementById("qualidadeAcordeLookup");
        const selectFormaAcordeLookup = document.getElementById("formaAcordeLookup");
        const btnBuscarAcordeCompleto = document.getElementById("buscarAcordeCompleto");
        const detalhesAcordeCompletoDiv = document.getElementById("detalhesAcordeCompleto");
        const tabelaDesenhosIDsBody = document.querySelector("#tabelaDesenhosIDs tbody");

        // Funções Auxiliares
        function transporNotas(notasBase, tomAcorde) {
            const notasTranspostas = [];
            const indiceTomRaiz = NOTAS_CROMATICAS.indexOf(tomAcorde);

            if (indiceTomRaiz === -1) return ["Erro: Tom inválido"];

            notasBase.forEach(nota => {
                const notaLimpa = nota.replace(/#|b/g, ''); 
                const indiceNotaBase = NOTAS_CROMATICAS.indexOf(notaLimpa);
                
                if (indiceNotaBase === -1) {
                    notasTranspostas.push("?"); 
                    return;
                }

                let indiceTransposto = (indiceNotaBase + indiceTomRaiz) % NOTAS_CROMATICAS.length;
                let notaTransposta = NOTAS_CROMATICAS[indiceTransposto];
                
                if (nota.includes("#") && !notaTransposta.includes("#") && !notaTransposta.includes("b")) {
                    const originalIndex = NOTAS_CROMATICAS.indexOf(nota);
                    const newIndex = (originalIndex + indiceTomRaiz) % NOTAS_CROMATICAS.length;
                    if(NOTAS_CROMATICAS[newIndex] === notaTransposta + '#') {
                        notaTransposta += '#';
                    }
                } else if (nota.includes("b") && !notaTransposta.includes("#") && !notaTransposta.includes("b")) {
                    const originalIndex = NOTAS_CROMATICAS.indexOf(nota);
                    const newIndex = (originalIndex + indiceTomRaiz) % NOTAS_CROMATICAS.length;
                    if(NOTAS_CROMATICAS[newIndex] === notaTransposta + 'b') {
                        notaTransposta += 'b';
                    }
                }
                notasTranspostas.push(notaTransposta);
            });

            return notasTranspostas;
        }

        function preencherSeletores() {
            NOTAS_CROMATICAS.forEach(tom => {
                const option = document.createElement("option");
                option.value = tom;
                option.textContent = tom;
                selectTomAcordeLookup.appendChild(option);
            });

            QUALIDADES_ORDEM.forEach(qualidade => {
                const option = document.createElement("option");
                option.value = qualidade;
                option.textContent = qualidade;
                selectQualidadeAcordeLookup.appendChild(option);
            });

            FORMAS_CAGEDF_ORDEM.forEach(forma => {
                const option = document.createElement("option");
                option.value = forma;
                option.textContent = forma;
                selectFormaAcordeLookup.appendChild(option);
            });
        }

        function gerarTabelaTabela1() {
            tabelaDesenhosIDsBody.innerHTML = ''; 

            QUALIDADES_ORDEM.forEach((qualidade, idxQualidade) => {
                const row = document.createElement("tr");
                const cellQualidade = document.createElement("td");
                cellQualidade.textContent = qualidade;
                cellQualidade.classList.add("header-cell");
                row.appendChild(cellQualidade);

                FORMAS_CAGEDF_ORDEM.forEach((forma, idxForma) => {
                    const cell = document.createElement("td");
                    const id = (idxQualidade * FORMAS_CAGEDF_ORDEM.length) + (idxForma + 1);
                    cell.textContent = id;
                    row.appendChild(cell);
                });
                tabelaDesenhosIDsBody.appendChild(row);
            });
        }

        const acordesTocaveis = []; 

        function gerarAcordesTocaveis() {
            let idAcordeTocavel = 1; 
            acordesTocaveis.length = 0;

            desenhosAcordes.forEach(desenho => {
                const notaRaizFormaOriginal = FORMAS_CAGEDF_RAIZ[desenho.forma_cagedf];
                const indiceRaizFormaOriginal = NOTAS_CROMATICAS.indexOf(notaRaizFormaOriginal);

                NOTAS_CROMATICAS.forEach(tom => {
                    const sufixoQualidade = QUALIDADE_SUFIXOS[desenho.qualidade] || '';
                    const nomeAcordeCompleto = `${tom}${sufixoQualidade} (Forma ${desenho.forma_cagedf})`;

                    const notasReais = transporNotas(desenho.notas_base, tom);

                    const indiceTomAtual = NOTAS_CROMATICAS.indexOf(tom);
                    let semitonsDeDeslocamento = indiceTomAtual - indiceRaizFormaOriginal;
                    if (semitonsDeDeslocamento < 0) { 
                        semitonsDeDeslocamento += NOTAS_CROMATICAS.length; 
                    }

                    const casaPestanaReal = desenho.casa_pestana_base + semitonsDeDeslocamento;

                    acordesTocaveis.push({
                        id: idAcordeTocavel,
                        id_desenho: desenho.id,
                        tom: tom,
                        qualidade: desenho.qualidade,
                        forma_cagedf: desenho.forma_cagedf,
                        nome_completo: nomeAcordeCompleto,
                        desenho_string: desenho.desenho_string, 
                        notas_reais: notasReais,
                        intervalos: desenho.intervalos,
                        dicas: desenho.dicas,
                        casa_pestana: casaPestanaReal,
                        tem_pestana: (casaPestanaReal > 0) 
                    });
                    idAcordeTocavel++;
                });
            });
        }

        function desenharDiagramaAcorde(desenhoString, casaPestana) {
            const container = document.getElementById("diagramaAcordeContainer");
            container.innerHTML = '<div class="diagrama-titulo">Diagrama do Acorde</div>';

            // Configurações do diagrama
            const numCordas = 6;
            const numCasas = 4; // Mostrar 4 casas (incluindo a pestana se houver)
            const larguraDiagrama = 250;
            const alturaDiagrama = 180;
            const padding = 20;
            const espacoEntreCordas = (larguraDiagrama - 2 * padding) / (numCordas - 1);
            const espacoEntreCasas = (alturaDiagrama - 2 * padding) / numCasas;
            const raioPonto = 10;

            // Criar elemento SVG
            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute("width", larguraDiagrama);
            svg.setAttribute("height", alturaDiagrama);
            svg.setAttribute("viewBox", `0 0 ${larguraDiagrama} ${alturaDiagrama}`);

            // Desenhar o nut (se casaPestana = 0) ou a pestana
            if (casaPestana === 0) {
                // Nut (mais grosso)
                const nut = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                nut.setAttribute("x", padding);
                nut.setAttribute("y", padding);
                nut.setAttribute("width", larguraDiagrama - 2 * padding);
                nut.setAttribute("height", 5);
                nut.setAttribute("fill", "#333");
                svg.appendChild(nut);
            } else {
                // Pestana (traste mais grosso)
                const pestana = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                pestana.setAttribute("x", padding);
                pestana.setAttribute("y", padding);
                pestana.setAttribute("width", larguraDiagrama - 2 * padding);
                pestana.setAttribute("height", 5);
                pestana.setAttribute("fill", "#333");
                svg.appendChild(pestana);
            }

            // Desenhar os trastes (linhas horizontais)
            for (let i = 0; i <= numCasas; i++) {
                const y = padding + (i * espacoEntreCasas);
                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", padding);
                line.setAttribute("y1", y);
                line.setAttribute("x2", larguraDiagrama - padding);
                line.setAttribute("y2", y);
                line.setAttribute("stroke", "#555");
                line.setAttribute("stroke-width", "1");
                svg.appendChild(line);
            }

            // Desenhar as cordas (linhas verticais)
            for (let i = 0; i < numCordas; i++) {
                const x = padding + (i * espacoEntreCordas);
                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", x);
                line.setAttribute("y1", padding);
                line.setAttribute("x2", x);
                line.setAttribute("y2", alturaDiagrama - padding);
                line.setAttribute("stroke", "#555");
                line.setAttribute("stroke-width", i === 0 || i === numCordas - 1 ? "3" : "2");
                svg.appendChild(line);
            }

            // Processar o desenho do acorde (da 6ª corda para a 1ª)
            const desenhoArray = desenhoString.split('');
            let pestanaInicio = -1;
            let pestanaFim = -1;

            for (let i = 0; i < numCordas; i++) {
                const corda = i; // 0 = 6ª corda (Mi grave), 5 = 1ª corda (Mi aguda)
                const fret = desenhoArray[corda];
                const x = padding + (corda * espacoEntreCordas);

                if (fret === 'x') {
                    // Corda não tocada (X)
                    const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    text.setAttribute("x", x);
                    text.setAttribute("y", padding - 10);
                    text.setAttribute("fill", "red");
                    text.setAttribute("font-size", "14");
                    text.setAttribute("text-anchor", "middle");
                    text.textContent = "X";
                    svg.appendChild(text);
                } else if (fret === '0') {
                    // Corda solta (O)
                    const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                    circle.setAttribute("cx", x);
                    circle.setAttribute("cy", padding - 8);
                    circle.setAttribute("r", "6");
                    circle.setAttribute("fill", "none");
                    circle.setAttribute("stroke", "blue");
                    circle.setAttribute("stroke-width", "1");
                    svg.appendChild(circle);
                } else {
                    // Nota pressionada
                    const fretNum = parseInt(fret, 10);
                    if (fretNum > 0) {
                        // Verificar se é parte de uma pestana
                        if (fretNum === casaPestana && casaPestana > 0) {
                            if (pestanaInicio === -1 || corda < pestanaInicio) {
                                pestanaInicio = corda;
                            }
                            if (pestanaFim === -1 || corda > pestanaFim) {
                                pestanaFim = corda;
                            }
                        } else {
                            // Desenhar ponto normal
                            const y = padding + ((fretNum - casaPestana) * espacoEntreCasas) - (espacoEntreCasas / 2);
                            const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                            circle.setAttribute("cx", x);
                            circle.setAttribute("cy", y);
                            circle.setAttribute("r", raioPonto);
                            circle.setAttribute("fill", "#007bff");
                            svg.appendChild(circle);
                        }
                    }
                }
            }

            // Desenhar a pestana (se aplicável)
            if (casaPestana > 0 && pestanaInicio !== -1 && pestanaFim !== -1) {
                const y = padding - (espacoEntreCasas / 2);
                const x1 = padding + (pestanaInicio * espacoEntreCordas);
                const x2 = padding + (pestanaFim * espacoEntreCordas);
                
                const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                rect.setAttribute("x", x1 - raioPonto);
                rect.setAttribute("y", y - raioPonto);
                rect.setAttribute("width", (x2 - x1) + (2 * raioPonto));
                rect.setAttribute("height", raioPonto * 2);
                rect.setAttribute("rx", raioPonto);
                rect.setAttribute("ry", raioPonto);
                rect.setAttribute("fill", "#007bff");
                svg.appendChild(rect);
            }

            // Adicionar número da casa da pestana (se houver)
            if (casaPestana > 0) {
                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute("x", larguraDiagrama - padding + 5);
                text.setAttribute("y", padding + (espacoEntreCasas / 2));
                text.setAttribute("fill", "#333");
                text.setAttribute("font-size", "12");
                text.textContent = casaPestana;
                svg.appendChild(text);
            }

            container.appendChild(svg);
        }

        function buscarAcordeCompleto() {
            const tomSelecionado = selectTomAcordeLookup.value;
            const qualidadeSelecionada = selectQualidadeAcordeLookup.value;
            const formaSelecionada = selectFormaAcordeLookup.value;

            const indiceQualidade = QUALIDADES_ORDEM.indexOf(qualidadeSelecionada);
            const indiceForma = FORMAS_CAGEDF_ORDEM.indexOf(formaSelecionada);

            if (indiceQualidade === -1 || indiceForma === -1) {
                detalhesAcordeCompletoDiv.innerHTML = "<p>Selecione uma qualidade e forma válidas.</p>";
                document.getElementById("diagramaAcordeContainer").innerHTML = ''; 
                return;
            }

            const idDesenhoBase = (indiceQualidade * FORMAS_CAGEDF_ORDEM.length) + (indiceForma + 1);

            const acordeEncontrado = acordesTocaveis.find(acorde =>
                acorde.id_desenho === idDesenhoBase &&
                acorde.tom === tomSelecionado
            );

            if (acordeEncontrado) {
                let pestanaInfo = "";
                if (acordeEncontrado.casa_pestana > 0) {
                    pestanaInfo = `<p><strong>Pestana na Casa:</strong> ${acordeEncontrado.casa_pestana}ª</p>`;
                } else {
                    pestanaInfo = `<p><strong>Pestana:</strong> Não aplicável (posição aberta).</p>`;
                }

                detalhesAcordeCompletoDiv.innerHTML = `
                    <h3>Acorde Encontrado: ${acordeEncontrado.nome_completo}</h3>
                    <p><strong>ID na Tabela 2:</strong> ${acordeEncontrado.id}</p>
                    <p><strong>ID do Desenho Base:</strong> ${acordeEncontrado.id_desenho}</p>
                    <p><strong>Tom:</strong> ${acordeEncontrado.tom}</p>
                    <p><strong>Qualidade:</strong> ${acordeEncontrado.qualidade}</p>
                    <p><strong>Forma CAGEDF:</strong> ${acordeEncontrado.forma_cagedf}</p>
                    ${pestanaInfo} 
                    <p><strong>Desenho (cordas 6 a 1):</strong> <code>${acordeEncontrado.desenho_string}</code></p>
                    <p><strong>Notas Reais:</strong> ${acordeEncontrado.notas_reais.join(", ")}</p>
                    <p><strong>Intervalos:</strong> ${acordeEncontrado.intervalos.join(", ")}</p>
                    <p><strong>Dicas:</strong> ${acordeEncontrado.dicas}</p>
                `;
                
                desenharDiagramaAcorde(acordeEncontrado.desenho_string, acordeEncontrado.casa_pestana);
            } else {
                detalhesAcordeCompletoDiv.innerHTML = `<p>Acorde não encontrado para a combinação selecionada.</p>`;
                document.getElementById("diagramaAcordeContainer").innerHTML = ''; 
            }
        }

        // Inicialização
        document.addEventListener("DOMContentLoaded", () => {
            preencherSeletores();
            gerarTabelaTabela1(); 
            gerarAcordesTocaveis(); 

            // Pré-selecionar os primeiros itens e realizar a busca inicial
            if (selectTomAcordeLookup.options.length > 0) selectTomAcordeLookup.selectedIndex = 0;
            if (selectQualidadeAcordeLookup.options.length > 0) selectQualidadeAcordeLookup.selectedIndex = 0;
            if (selectFormaAcordeLookup.options.length > 0) selectFormaAcordeLookup.selectedIndex = 0;
            buscarAcordeCompleto(); 
        });

        // Event Listeners
        btnBuscarAcordeCompleto.addEventListener("click", buscarAcordeCompleto);
        selectTomAcordeLookup.addEventListener("change", buscarAcordeCompleto);
        selectQualidadeAcordeLookup.addEventListener("change", buscarAcordeCompleto);
        selectFormaAcordeLookup.addEventListener("change", buscarAcordeCompleto);
    </script>
</body>
</html>
