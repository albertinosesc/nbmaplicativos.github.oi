<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acordes Violão - Catálogo Completo</title>
    
    <style>
        /* --- Código CSS (mantido o mesmo) --- */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        header {
            background-color: #333;
            color: white;
            padding: 10px 0;
            text-align: center;
        }
        main {
            max-width: 900px;
            margin: 20px auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        .controls label {
            margin-right: 10px;
        }
        .controls select, .controls button {
            padding: 8px;
            margin-right: 15px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        .controls button {
            background-color: #007bff;
            color: white;
            cursor: pointer;
            border: none;
        }
        .controls button:hover {
            background-color: #0056b3;
        }
        #detalhesAcordeCompleto { /* Ajustado para o novo ID */
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 4px;
            background-color: #f9f9f9;
            margin-top: 15px;
        }
        #detalhesAcordeCompleto h3 {
            margin-top: 0;
            color: #007bff;
        }
        #detalhesAcordeCompleto code {
            background-color: #e9e9e9;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: monospace;
        }
        .table-container {
            overflow-x: auto; /* Para rolagem em telas pequenas */
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table th, table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        table td.header-cell { /* Estilo para a coluna de Qualidade */
            background-color: #f2f2f2;
            font-weight: bold;
            text-align: left;
        }
        .acorde-lookup-area { /* Renomeada e ajustada para a nova funcionalidade */
            margin-top: 30px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        /* As classes acorde-card e .acordes-tocaveis-area foram removidas, pois não estamos listando vários acordes */
        footer {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            color: #777;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <header>
        <h1>Catálogo de Acordes de Violão</h1>
    </header>

    <main>
        <section class="acorde-lookup-area">
            <h2>Buscar Acorde Completo (Tabela 2)</h2>
            <div class="controls">
                <label for="tomAcordeLookup">Tom:</label>
                <select id="tomAcordeLookup">
                    </select>

                <label for="qualidadeAcordeLookup">Qualidade:</label>
                <select id="qualidadeAcordeLookup">
                    </select>

                <label for="formaAcordeLookup">Forma CAGEDF:</label>
                <select id="formaAcordeLookup">
                    </select>

                <button id="buscarAcordeCompleto">Buscar Acorde</button>
            </div>
            <div id="detalhesAcordeCompleto">
                <p>Selecione um tom, qualidade e forma para ver os detalhes do acorde.</p>
                <div id="diagramaAcordeContainer" style="margin-top: 20px;"></div>

            </div>
        </section>

        <section class="table-area">
            <h2>Tabela de IDs de Desenho (CAGEDF x Qualidade)</h2>
            <div class="table-container">
                <table id="tabelaDesenhosIDs">
                    <thead>
                        <tr>
                            <th>Qualidade \ Forma</th>
                            <th>C</th>
                            <th>A</th>
                            <th>G</th>
                            <th>E</th>
                            <th>D</th>
                            <th>F</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 Seu Sistema de Acordes</p>
    </footer>

    <script>
        // --- Código JavaScript (adaptado do script.js) ---

        // --- 1. Estrutura de Dados para os Desenhos de Acorde (Sua "Detalhes Desenhos") ---
        const desenhosAcordes = [
            // --- Maior (IDs 1-6) ---
            {
                id: 1,
                qualidade: "Maior",
                forma_cagedf: "C",
                desenho_string: "x32010",
                notas_base: ["C", "E", "G"],
                intervalos: ["1", "3M", "5J"],
                dicas: "Dedo 3 na 5ª corda (casa 3), Dedo 2 na 4ª corda (casa 2), Dedo 1 na 2ª corda (casa 1). Não tocar a 6ª corda.",
                casa_pestana_base: 0 // C Maior (aberto)
            },
            {
                id: 2,
                qualidade: "Maior",
                forma_cagedf: "A",
                desenho_string: "x02220",
                notas_base: ["A", "C#", "E"],
                intervalos: ["1", "3M", "5J"],
                dicas: "Cuidado para não abafar a 1ª corda. Dedo 2, 3 e 4 nas cordas 4, 3 e 2 na casa 2.",
                casa_pestana_base: 0 // A Maior (aberto)
            },
            {
                id: 3,
                qualidade: "Maior",
                forma_cagedf: "G",
                desenho_string: "320003",
                notas_base: ["G", "B", "D"],
                intervalos: ["1", "3M", "5J"],
                dicas: "Formato padrão e versátil. Dedo 3 na 6ª corda (casa 3), Dedo 2 na 5ª corda (casa 2), Dedo 4 na 1ª corda (casa 3).",
                casa_pestana_base: 0 // G Maior (aberto)
            },
            {
                id: 4,
                qualidade: "Maior",
                forma_cagedf: "E",
                desenho_string: "022100",
                notas_base: ["E", "G#", "B"],
                intervalos: ["1", "3M", "5J"],
                dicas: "Forma básica para pestanas. Dedo 2 na 5ª corda (casa 2), Dedo 3 na 4ª corda (casa 2), Dedo 1 na 3ª corda (casa 1).",
                casa_pestana_base: 0 // E Maior (aberto)
            },
            {
                id: 5,
                qualidade: "Maior",
                forma_cagedf: "D",
                desenho_string: "xx0232",
                notas_base: ["D", "F#", "A"],
                intervalos: ["1", "3M", "5J"],
                dicas: "Não tocar cordas 5 e 6. Dedo 1 na 3ª corda (casa 2), Dedo 3 na 2ª corda (casa 3), Dedo 2 na 1ª corda (casa 2).",
                casa_pestana_base: 0 // D Maior (aberto)
            },
            {
                id: 6,
                qualidade: "Maior",
                forma_cagedf: "F",
                desenho_string: "XX3211", // Sua notação para o F Maior
                notas_base: ["F", "A", "C"],
                intervalos: ["1", "3M", "5J"],
                dicas: "Não tocar as cordas Mi grave (6) e Lá (5). Começa na corda Ré, casa 3. Exige pestana na 1ª casa para cordas Si e Mi aguda.",
                casa_pestana_base: 1 // F Maior (com pestana na 1ª)
            },

            // --- Menor (IDs 7-12) ---
            {
                id: 7,
                qualidade: "Menor",
                forma_cagedf: "C",
                desenho_string: "x35543",
                notas_base: ["C", "Eb", "G"],
                intervalos: ["1", "3m", "5J"],
                dicas: "Pestana com dedo 1 na casa 3 (corda 5). Formato da forma Am.",
                casa_pestana_base: 0 // Cm em forma de Am (aberta)
            },
            {
                id: 8,
                qualidade: "Menor",
                forma_cagedf: "A",
                desenho_string: "x02210",
                notas_base: ["A", "C", "E"],
                intervalos: ["1", "3m", "5J"],
                dicas: "Cuidado para não abafar a 1ª corda. Dedo 2 na 4ª corda (casa 2), Dedo 3 na 3ª corda (casa 2), Dedo 1 na 2ª corda (casa 1).",
                casa_pestana_base: 0 // Am (aberto)
            },
            {
                id: 9,
                qualidade: "Menor",
                forma_cagedf: "G",
                desenho_string: "355333",
                notas_base: ["G", "Bb", "D"],
                intervalos: ["1", "3m", "5J"],
                dicas: "Pestana na casa 3. Formato da forma Em.",
                casa_pestana_base: 0 // Gm em forma de Em (aberta)
            },
            {
                id: 10,
                qualidade: "Menor",
                forma_cagedf: "E",
                desenho_string: "022000",
                notas_base: ["E", "G", "B"],
                intervalos: ["1", "3m", "5J"],
                dicas: "Dedo 2 na 5ª corda (casa 2), Dedo 3 na 4ª corda (casa 2). Cordas 1, 2, 3 e 6 soltas.",
                casa_pestana_base: 0 // Em (aberto)
            },
            {
                id: 11,
                qualidade: "Menor",
                forma_cagedf: "D",
                desenho_string: "xx0231",
                notas_base: ["D", "F", "A"],
                intervalos: ["1", "3m", "5J"],
                dicas: "Não tocar cordas 5 e 6. Dedo 1 na 1ª corda (casa 1), Dedo 2 na 3ª corda (casa 2), Dedo 3 na 2ª corda (casa 3).",
                casa_pestana_base: 0 // Dm (aberto)
            },
            {
                id: 12,
                qualidade: "Menor",
                forma_cagedf: "F", // F menor usando a forma de Dm transposta (com pestana)
                desenho_string: "XX3111", // Representação de um F menor que não toca as cordas 5 e 6
                notas_base: ["F", "Ab", "C"],
                intervalos: ["1", "3m", "5J"],
                dicas: "Não tocar as cordas Mi grave (6) e Lá (5). Pestana na casa 1 (cordas 1, 2, 3).",
                casa_pestana_base: 1 // Fm (com pestana na 1ª)
            },

            // --- Diminuto (IDs 13-18) ---
            {
                id: 13,
                qualidade: "Diminuto",
                forma_cagedf: "C",
                desenho_string: "x3454x",
                notas_base: ["C", "Eb", "Gb"],
                intervalos: ["1", "3m", "5d"],
                dicas: "Pestana com dedo 1 na casa 3 (corda 5) e dedo 4 na casa 5 (corda 4). Difícil.",
                casa_pestana_base: 0 // Cdim na forma Am
            },
            {
                id: 14,
                qualidade: "Diminuto",
                forma_cagedf: "A",
                desenho_string: "x0121x",
                notas_base: ["A", "C", "Eb"],
                intervalos: ["1", "3m", "5d"],
                dicas: "Dedo 1 na 3ª corda (casa 1). Difícil de soar limpo.",
                casa_pestana_base: 0 // Adim (aberto)
            },
            {
                id: 15,
                qualidade: "Diminuto",
                forma_cagedf: "G",
                desenho_string: "345353",
                notas_base: ["G", "Bb", "Db"],
                intervalos: ["1", "3m", "5d"],
                dicas: "Pestana com dedo 1 na casa 3. Difícil pela forma Em diminuta.",
                casa_pestana_base: 0 // Gdim na forma Em
            },
            {
                id: 16,
                qualidade: "Diminuto",
                forma_cagedf: "E",
                desenho_string: "x2323x",
                notas_base: ["E", "G", "Bb"],
                intervalos: ["1", "3m", "5d"],
                dicas: "Dedo 2 na 5ª corda (casa 2), dedo 3 na 4ª corda (casa 3), dedo 1 na 3ª corda (casa 2).",
                casa_pestana_base: 0 // Edim (aberto)
            },
            {
                id: 17,
                qualidade: "Diminuto",
                forma_cagedf: "D",
                desenho_string: "xx0131",
                notas_base: ["D", "F", "Ab"],
                intervalos: ["1", "3m", "5d"],
                dicas: "Não tocar cordas 5 e 6. Dedo 1 na 3ª corda (casa 1), Dedo 3 na 2ª corda (casa 3), Dedo 1 na 1ª corda (casa 1).",
                casa_pestana_base: 0 // Ddim (aberto)
            },
            {
                id: 18,
                qualidade: "Diminuto",
                forma_cagedf: "F", // F diminuto usando a forma de Dm diminuta transposta
                desenho_string: "XX3434",
                notas_base: ["F", "Ab", "B"],
                intervalos: ["1", "3m", "5d"],
                dicas: "Não tocar cordas 5 e 6. Dedo 1 na corda Ré casa 3, Dedo 2 na corda Sol casa 4.",
                casa_pestana_base: 1 // Fdim (com pestana na 1ª)
            },

            // --- Aumentado (IDs 19-24) ---
            {
                id: 19,
                qualidade: "Aumentado",
                forma_cagedf: "C",
                desenho_string: "x32110", // Exemplo de C aumentado baseado na forma C (C-E-G#)
                notas_base: ["C", "E", "G#"],
                intervalos: ["1", "3M", "5a"],
                dicas: "Dedo 1 na 2ª corda (casa 1), Dedo 2 na 4ª corda (casa 2), Dedo 3 na 5ª corda (casa 3).",
                casa_pestana_base: 0 // Caug na forma C
            },
            {
                id: 20,
                qualidade: "Aumentado",
                forma_cagedf: "A",
                desenho_string: "x02110",
                notas_base: ["A", "C#", "F"],
                intervalos: ["1", "3M", "5a"],
                dicas: "Similar ao A maior, mas com a 3ª corda na casa 1. Cuidado para não abafar.",
                casa_pestana_base: 0 // Aaug (aberto)
            },
            {
                id: 21,
                qualidade: "Aumentado",
                forma_cagedf: "G",
                desenho_string: "321000",
                notas_base: ["G", "B", "D#"],
                intervalos: ["1", "3M", "5a"],
                dicas: "Dedo 1 na 3ª corda (casa 1), Dedo 2 na 5ª corda (casa 2), Dedo 3 na 6ª corda (casa 3).",
                casa_pestana_base: 0 // Gaug (aberto)
            },
            {
                id: 22,
                qualidade: "Aumentado",
                forma_cagedf: "E",
                desenho_string: "02110x",
                notas_base: ["E", "G#", "C"],
                intervalos: ["1", "3M", "5a"],
                dicas: "Não tocar a 1ª corda. Dedo 1 na 3ª corda (casa 1), Dedo 2 na 5ª corda (casa 2), Dedo 3 na 4ª corda (casa 1).",
                casa_pestana_base: 0 // Eaug (aberto)
            },
            {
                id: 23,
                qualidade: "Aumentado",
                forma_cagedf: "D",
                desenho_string: "xx0332",
                notas_base: ["D", "F#", "A#"],
                intervalos: ["1", "3M", "5a"],
                dicas: "Não tocar cordas 5 e 6. Dedo 1 na 1ª corda (casa 2), Dedo 2 e 3 na 2ª e 3ª cordas (casa 3).",
                casa_pestana_base: 0 // Daug (aberto)
            },
            {
                id: 24,
                qualidade: "Aumentado",
                forma_cagedf: "F", // F aumentado usando a forma de D transposta
                desenho_string: "XX433X", // F aumentado (F-A-C#)
                notas_base: ["F", "A", "C#"],
                intervalos: ["1", "3M", "5a"],
                dicas: "Não tocar cordas 6 e 1. Dedo 1 na 3ª corda (casa 3), Dedo 2 na 2ª corda (casa 3), Dedo 3 na 4ª corda (casa 4).",
                casa_pestana_base: 1 // Faug (com pestana na 1ª)
            }
            // Adicione mais qualidades e seus 6 desenhos CAGEDF aqui
        ];

        // --- 2. Listas de referência para mapeamento e seleção ---
        const QUALIDADES_ORDEM = [
            "Maior", "Menor", "Diminuto", "Aumentado"
            // Adicione mais qualidades aqui na ordem que você usou para os IDs
        ];
        const FORMAS_CAGEDF_ORDEM = ["C", "A", "G", "E", "D", "F"];

        // Constantes musicais para transposição de notas
        const NOTAS_CROMATICAS = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];
        const QUALIDADE_SUFIXOS = {
            "Maior": "",
            "Menor": "m",
            "Diminuto": "dim",
            "Aumentado": "aug",
        };

        // NOVO: Notas raiz de cada forma CAGEDF quando tocada na posição aberta
        const FORMAS_CAGEDF_RAIZ = {
            "C": "C",
            "A": "A",
            "G": "G",
            "E": "E",
            "D": "D",
            "F": "F" 
        };

        // --- Elementos HTML para a busca de acorde completo ---
        const selectTomAcordeLookup = document.getElementById("tomAcordeLookup");
        const selectQualidadeAcordeLookup = document.getElementById("qualidadeAcordeLookup");
        const selectFormaAcordeLookup = document.getElementById("formaAcordeLookup");
        const btnBuscarAcordeCompleto = document.getElementById("buscarAcordeCompleto");
        const detalhesAcordeCompletoDiv = document.getElementById("detalhesAcordeCompleto");
        
        // Elemento HTML para a Tabela de IDs de Desenho (Tabela 1)
        const tabelaDesenhosIDsBody = document.querySelector("#tabelaDesenhosIDs tbody");


        // --- Funções Auxiliares ---

        // Função para transpor notas de um acorde base para um novo tom
        function transporNotas(notasBase, tomAcorde) {
            const notasTranspostas = [];
            const indiceTomRaiz = NOTAS_CROMATICAS.indexOf(tomAcorde);

            if (indiceTomRaiz === -1) {
                return ["Erro: Tom inválido"];
            }

            notasBase.forEach(nota => {
                const notaLimpa = nota.replace(/#|b/g, ''); 
                const indiceNotaBase = NOTAS_CROMATICAS.indexOf(notaLimpa);
                
                if (indiceNotaBase === -1) {
                    notasTranspostas.push("?"); 
                    return;
                }

                let indiceTransposto = (indiceNotaBase + indiceTomRaiz) % NOTAS_CROMATICAS.length;
                let notaTransposta = NOTAS_CROMATICAS[indiceTransposto];
                
                if (nota.includes("#") && !notaTransposta.includes("#") && !notaTransposta.includes("b")) {
                    const originalIndex = NOTAS_CROMATICAS.indexOf(nota);
                    const newIndex = (originalIndex + indiceTomRaiz) % NOTAS_CROMATICAS.length;
                    if(NOTAS_CROMATICAS[newIndex] === notaTransposta + '#') {
                        notaTransposta += '#';
                    }
                } else if (nota.includes("b") && !notaTransposta.includes("#") && !notaTransposta.includes("b")) {
                    const originalIndex = NOTAS_CROMATICAS.indexOf(nota);
                    const newIndex = (originalIndex + indiceTomRaiz) % NOTAS_CROMATICAS.length;
                    if(NOTAS_CROMATICAS[newIndex] === notaTransposta + 'b') {
                        notaTransposta += 'b';
                    }
                }
                notasTranspostas.push(notaTransposta);
            });

            return notasTranspostas;
        }


        // --- Função para preencher os seletores ---
        function preencherSeletores() {
            // Preencher seletores para a busca de acorde completo
            NOTAS_CROMATICAS.forEach(tom => {
                const option = document.createElement("option");
                option.value = tom;
                option.textContent = tom;
                selectTomAcordeLookup.appendChild(option);
            });

            QUALIDADES_ORDEM.forEach(qualidade => {
                const option = document.createElement("option");
                option.value = qualidade;
                option.textContent = qualidade;
                selectQualidadeAcordeLookup.appendChild(option);
            });

            FORMAS_CAGEDF_ORDEM.forEach(forma => {
                const option = document.createElement("option");
                option.value = forma;
                option.textContent = forma;
                selectFormaAcordeLookup.appendChild(option);
            });
        }

        // --- Gerar e exibir a Tabela de IDs de Desenho (Sua Tabela 1) ---
        function gerarTabelaTabela1() {
            tabelaDesenhosIDsBody.innerHTML = ''; 

            QUALIDADES_ORDEM.forEach((qualidade, idxQualidade) => {
                const row = document.createElement("tr");
                const cellQualidade = document.createElement("td");
                cellQualidade.textContent = qualidade;
                cellQualidade.classList.add("header-cell");
                row.appendChild(cellQualidade);

                FORMAS_CAGEDF_ORDEM.forEach((forma, idxForma) => {
                    const cell = document.createElement("td");
                    const id = (idxQualidade * FORMAS_CAGEDF_ORDEM.length) + (idxForma + 1);
                    cell.textContent = id;
                    row.appendChild(cell);
                });
                tabelaDesenhosIDsBody.appendChild(row);
            });
        }

        // --- Lógica para a Tabela 2: Gerar Acordes Tocáveis (lista completa em memória) ---
        const acordesTocaveis = []; 

        function gerarAcordesTocaveis() {
            let idAcordeTocavel = 1; 
            acordesTocaveis.length = 0; // Limpa a lista antes de gerar (importante se for chamada múltiplas vezes)

            desenhosAcordes.forEach(desenho => {
                // Encontra a nota raiz da forma CAGEDF original (ex: "C" para a forma "C")
                const notaRaizFormaOriginal = FORMAS_CAGEDF_RAIZ[desenho.forma_cagedf];
                const indiceRaizFormaOriginal = NOTAS_CROMATICAS.indexOf(notaRaizFormaOriginal);

                NOTAS_CROMATICAS.forEach(tom => {
                    const sufixoQualidade = QUALIDADE_SUFIXOS[desenho.qualidade] || '';
                    const nomeAcordeCompleto = `${tom}${sufixoQualidade} (Forma ${desenho.forma_cagedf})`;

                    const notasReais = transporNotas(desenho.notas_base, tom);

                    // Calcular a casa da pestana para o acorde transposto
                    const indiceTomAtual = NOTAS_CROMATICAS.indexOf(tom);
                    let semitonsDeDeslocamento = indiceTomAtual - indiceRaizFormaOriginal;
                    if (semitonsDeDeslocamento < 0) { 
                        semitonsDeDeslocamento += NOTAS_CROMATICAS.length; 
                    }

                    const casaPestanaReal = desenho.casa_pestana_base + semitonsDeDeslocamento;

                    acordesTocaveis.push({
                        id: idAcordeTocavel, // ID único da Tabela 2
                        id_desenho: desenho.id, // ID original do desenho (da Tabela 1)
                        tom: tom,
                        qualidade: desenho.qualidade,
                        forma_cagedf: desenho.forma_cagedf,
                        nome_completo: nomeAcordeCompleto,
                        desenho_string: desenho.desenho_string, 
                        notas_reais: notasReais,
                        intervalos: desenho.intervalos,
                        dicas: desenho.dicas,
                        // NOVO: Informações da pestana
                        casa_pestana: casaPestanaReal,
                        tem_pestana: (casaPestanaReal > 0) 
                    });
                    idAcordeTocavel++;
                });
            });
            console.log(`Gerados ${acordesTocaveis.length} acordes tocáveis no total.`);
        }

        // --- NOVO: Função para desenhar o diagrama do acorde ---
        function desenharDiagramaAcorde(desenhoString, casaPestana) {
            const container = document.getElementById("diagramaAcordeContainer");
            container.innerHTML = ''; // Limpa qualquer diagrama anterior

            const numCordas = 6; // Violão de 6 cordas
            const numCasas = 5; // Mostrar 5 casas do braço (ajustável)
            const larguraCorda = 2; // Espessura das cordas
            const larguraTraste = 4; // Espessura dos trastes
            const padding = 20; // Espaçamento interno
            const larguraDiagrama = 200;
            const alturaDiagrama = 250;

            const espacoEntreCordas = (larguraDiagrama - 2 * padding) / (numCordas - 1);
            const espacoEntreCasas = (alturaDiagrama - 2 * padding - larguraTraste) / numCasas;

            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute("width", larguraDiagrama);
            svg.setAttribute("height", alturaDiagrama);
            svg.setAttribute("viewBox", `0 0 ${larguraDiagrama} ${alturaDiagrama}`);

            // Desenhar o nut (pestana zero) ou o traste superior
            let inicioCasas = 0; // Se a pestana for na casa 0, começa no nut
            if (casaPestana > 0) {
                // Se o acorde tem pestana, o "nut" é o traste da pestana
                const trastePestana = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                trastePestana.setAttribute("x", padding);
                trastePestana.setAttribute("y", padding);
                trastePestana.setAttribute("width", larguraDiagrama - 2 * padding);
                trastePestana.setAttribute("height", larguraTraste);
                trastePestana.setAttribute("fill", "#555");
                svg.appendChild(trastePestana);
                inicioCasas = casaPestana; // A numeração das casas começa a partir da pestana
            } else {
                // Se não tem pestana, desenha o nut mais grosso
                const nut = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                nut.setAttribute("x", padding);
                nut.setAttribute("y", padding);
                nut.setAttribute("width", larguraDiagrama - 2 * padding);
                nut.setAttribute("height", larguraTraste * 2); // Nut mais grosso
                nut.setAttribute("fill", "#555");
                svg.appendChild(nut);
            }


            // Desenhar os trastes (linhas horizontais)
            for (let i = 0; i <= numCasas; i++) {
                const y = padding + (i * espacoEntreCasas) + (casaPestana === 0 ? larguraTraste * 2 : larguraTraste); // Ajusta a posição Y para o nut/traste
                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", padding);
                line.setAttribute("y1", y);
                line.setAttribute("x2", larguraDiagrama - padding);
                line.setAttribute("y2", y);
                line.setAttribute("stroke", "#ccc");
                line.setAttribute("stroke-width", larguraTraste);
                svg.appendChild(line);

                // Numerar as casas (opcional, mas útil)
                if (i > 0) {
                    const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    text.setAttribute("x", padding / 2); // Posição à esquerda
                    text.setAttribute("y", y - espacoEntreCasas / 2 + 5); // No meio da casa
                    text.setAttribute("fill", "#666");
                    text.setAttribute("font-size", "10px");
                    text.setAttribute("text-anchor", "middle");
                    text.textContent = inicioCasas + i;
                    svg.appendChild(text);
                }
            }

            // Desenhar as cordas (linhas verticais)
            for (let i = 0; i < numCordas; i++) {
                const x = padding + (i * espacoEntreCordas);
                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute("x1", x);
                line.setAttribute("y1", padding + (casaPestana === 0 ? larguraTraste * 2 : larguraTraste));
                line.setAttribute("x2", x);
                line.setAttribute("y2", alturaDiagrama - padding);
                line.setAttribute("stroke", "#555");
                line.setAttribute("stroke-width", larguraCorda);
                svg.appendChild(line);
            }

            // Desenhar os pontos dos dedos e as indicações de corda solta/mutada
            const desenhoArray = desenhoString.split(''); // Ex: ["x", "3", "2", "0", "1", "0"]
            const raioPonto = 8; // Raio dos círculos dos dedos

            // Para a pestana (barre)
            let pestanaInicioCorda = -1;
            let pestanaFimCorda = -1;
            let pestanaCasaDetectada = -1; // Usado para detectar se uma pestana foi desenhada

            // Percorre as cordas do violão (da 6ª para a 1ª)
            for (let i = 0; i < numCordas; i++) {
                const corda = numCordas - 1 - i; // Mapeia para o índice correto da string de desenho (0-5)
                const fret = desenhoArray[corda];
                const xCorda = padding + (i * espacoEntreCordas); // Posição X da corda no diagrama

                if (fret === 'x') {
                    // Corda mutada (X)
                    const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    text.setAttribute("x", xCorda);
                    text.setAttribute("y", padding - raioPonto); // Acima do nut
                    text.setAttribute("fill", "#900");
                    text.setAttribute("font-size", "14px");
                    text.setAttribute("font-weight", "bold");
                    text.setAttribute("text-anchor", "middle");
                    text.textContent = "X";
                    svg.appendChild(text);
                } else if (fret === '0') {
                    // Corda solta (O)
                    const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                    circle.setAttribute("cx", xCorda);
                    circle.setAttribute("cy", padding - raioPonto); // Acima do nut
                    circle.setAttribute("r", raioPonto / 2);
                    circle.setAttribute("fill", "transparent");
                    circle.setAttribute("stroke", "#007bff");
                    circle.setAttribute("stroke-width", "1.5");
                    svg.appendChild(circle);
                } else {
                    // Dedo na casa
                    const fretNum = parseInt(fret, 10);
                    if (fretNum > 0) {
                        const yFret = padding + (fretNum - inicioCasas) * espacoEntreCasas + (casaPestana === 0 ? larguraTraste * 2 : larguraTraste) - (espacoEntreCasas / 2);
                        
                        // Lógica para detectar e desenhar a pestana (barre)
                        // A pestana é desenhada se a casa do dedo for igual à casaPestana real E essa casa da pestana for > 0
                        if (fretNum === casaPestana && casaPestana > 0) {
                            if (pestanaInicioCorda === -1 || corda < pestanaInicioCorda) {
                                pestanaInicioCorda = corda; // Corda mais fina (maior índice na string)
                            }
                            if (pestanaFimCorda === -1 || corda > pestanaFimCorda) {
                                pestanaFimCorda = corda; // Corda mais grossa (menor índice na string)
                            }
                            pestanaCasaDetectada = fretNum; // Marca a casa da pestana
                        } else {
                            // Desenhar o ponto normal se não for parte da pestana principal
                            const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                            circle.setAttribute("cx", xCorda);
                            circle.setAttribute("cy", yFret);
                            circle.setAttribute("r", raioPonto);
                            circle.setAttribute("fill", "#007bff");
                            svg.appendChild(circle);
                        }
                    }
                }
            }

            // Desenhar a pestana (barre) se detectada
            // Verifica se a pestana foi detectada e abrange mais de uma corda
            if (pestanaCasaDetectada > 0 && pestanaInicioCorda !== -1 && pestanaFimCorda !== -1 && pestanaInicioCorda !== pestanaFimCorda) {
                const yBarre = padding + (pestanaCasaDetectada - inicioCasas) * espacoEntreCasas + (casaPestana === 0 ? larguraTraste * 2 : larguraTraste) - (espacoEntreCasas / 2);
                
                // As cordas são numeradas de 0 a 5 (Mi grave a Mi aguda)
                // No diagrama, a 6ª corda é a primeira da esquerda (i=0), a 1ª corda é a última da direita (i=5)
                // Então, pestanaInicioCorda (menor índice na string, corda mais fina) corresponde a um X maior no diagrama
                // E pestanaFimCorda (maior índice na string, corda mais grossa) corresponde a um X menor no diagrama
                const xInicioBarre = padding + (numCordas - 1 - pestanaFimCorda) * espacoEntreCordas; // Posição X da corda mais grossa barrada
                const xFimBarre = padding + (numCordas - 1 - pestanaInicioCorda) * espacoEntreCordas; // Posição X da corda mais fina barrada

                const rectBarre = document.createElementNS("http://www.w3.org/2000/svg", "rect");
                rectBarre.setAttribute("x", xInicioBarre - raioPonto);
                rectBarre.setAttribute("y", yBarre - raioPonto);
                rectBarre.setAttribute("width", xFimBarre - xInicioBarre + (2 * raioPonto));
                rectBarre.setAttribute("height", raioPonto * 2);
                rectBarre.setAttribute("rx", raioPonto); // Cantos arredondados
                rectBarre.setAttribute("ry", raioPonto);
                rectBarre.setAttribute("fill", "#007bff");
                svg.appendChild(rectBarre);
            }

            container.appendChild(svg);
        }

        // --- Função principal de busca de acorde completo (usando Tabela 2) ---
        function buscarAcordeCompleto() {
            const tomSelecionado = selectTomAcordeLookup.value;
            const qualidadeSelecionada = selectQualidadeAcordeLookup.value;
            const formaSelecionada = selectFormaAcordeLookup.value;

            // Primeiro, encontramos o ID do Desenho (da Tabela 1)
            const indiceQualidade = QUALIDADES_ORDEM.indexOf(qualidadeSelecionada);
            const indiceForma = FORMAS_CAGEDF_ORDEM.indexOf(formaSelecionada);

            if (indiceQualidade === -1 || indiceForma === -1) {
                detalhesAcordeCompletoDiv.innerHTML = "<p>Selecione uma qualidade e forma válidas.</p>";
                // Limpa o diagrama se a seleção for inválida
                document.getElementById("diagramaAcordeContainer").innerHTML = ''; 
                return;
            }

            const idDesenhoBase = (indiceQualidade * FORMAS_CAGEDF_ORDEM.length) + (indiceForma + 1);

            // Agora, buscamos o acorde completo na nossa lista 'acordesTocaveis'
            const acordeEncontrado = acordesTocaveis.find(acorde =>
                acorde.id_desenho === idDesenhoBase &&
                acorde.tom === tomSelecionado
            );

            if (acordeEncontrado) {
                let pestanaInfo = "";
                if (acordeEncontrado.casa_pestana > 0) {
                    pestanaInfo = `<p><strong>Pestana na Casa:</strong> ${acordeEncontrado.casa_pestana}ª</p>`;
                } else {
                    pestanaInfo = `<p><strong>Pestana:</strong> Não aplicável (posição aberta).</p>`;
                }

                detalhesAcordeCompletoDiv.innerHTML = `
                    <h3>Acorde Encontrado: ${acordeEncontrado.nome_completo}</h3>
                    <p><strong>ID na Tabela 2:</strong> ${acordeEncontrado.id}</p>
                    <p><strong>ID do Desenho Base:</strong> ${acordeEncontrado.id_desenho}</p>
                    <p><strong>Tom:</strong> ${acordeEncontrado.tom}</p>
                    <p><strong>Qualidade:</strong> ${acordeEncontrado.qualidade}</p>
                    <p><strong>Forma CAGEDF:</strong> ${acordeEncontrado.forma_cagedf}</p>
                    ${pestanaInfo} 
                    <p><strong>Desenho (cordas 6 a 1):</strong> <code>${acordeEncontrado.desenho_string}</code></p>
                    <p><strong>Notas Reais:</strong> ${acordeEncontrado.notas_reais.join(", ")}</p>
                    <p><strong>Intervalos:</strong> ${acordeEncontrado.intervalos.join(", ")}</p>
                    <p><strong>Dicas:</strong> ${acordeEncontrado.dicas}</p>
                `;
                
                // NOVO: Chamar a função para desenhar o diagrama
                desenharDiagramaAcorde(acordeEncontrado.desenho_string, acordeEncontrado.casa_pestana);

            } else {
                detalhesAcordeCompletoDiv.innerHTML = `<p>Acorde não encontrado para a combinação selecionada. Verifique se o desenho base existe para esta qualidade/forma.</p>`;
                // Limpa o diagrama se o acorde não for encontrado
                document.getElementById("diagramaAcordeContainer").innerHTML = ''; 
            }
        }


        // --- Event Listeners ---
        document.addEventListener("DOMContentLoaded", () => {
            preencherSeletores();
            gerarTabelaTabela1(); 
            gerarAcordesTocaveis(); 

            // Pré-selecionar os primeiros itens e realizar a busca inicial
            if (selectTomAcordeLookup.options.length > 0) selectTomAcordeLookup.selectedIndex = 0;
            if (selectQualidadeAcordeLookup.options.length > 0) selectQualidadeAcordeLookup.selectedIndex = 0;
            if (selectFormaAcordeLookup.options.length > 0) selectFormaAcordeLookup.selectedIndex = 0;
            buscarAcordeCompleto(); 

        });

        // Adiciona ouvintes para os controles de busca de acorde completo
        btnBuscarAcordeCompleto.addEventListener("click", buscarAcordeCompleto);
        selectTomAcordeLookup.addEventListener("change", buscarAcordeCompleto);
        selectQualidadeAcordeLookup.addEventListener("change", buscarAcordeCompleto);
        selectFormaAcordeLookup.addEventListener("change", buscarAcordeCompleto);
    </script>
</body>
</html>