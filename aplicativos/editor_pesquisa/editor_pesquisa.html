<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Biblioteca Musical</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
        }

        h1, h2 {
            color: #4CAF50;
        }

        #filter-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .filter-field label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .filter-field input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        #button-container {
            grid-column: 1 / -1;
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        button.search {
            background-color: #4CAF50;
            color: #fff;
        }

        button.clear {
            background-color: #f44336;
            color: #fff;
        }

        button:hover {
            opacity: 0.8;
        }
        
        #loading {
            display: none;
            text-align: center;
            font-style: italic;
            color: #666;
            margin-top: 20px;
        }

        #music-list {
            margin-top: 30px;
        }

        .music-item {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .music-item strong {
            color: #333;
        }

        .music-item a {
            color: #4CAF50;
            text-decoration: none;
            font-weight: bold;
        }

        .music-item a:hover {
            text-decoration: underline;
        }

        #no-results {
            display: none;
            text-align: center;
            color: #f44336;
            font-weight: bold;
            margin-top: 20px;
        }

    </style>
</head>
<body onload="loadSheet()">

    <h1>Biblioteca de Músicas</h1>

    <div id="filter-container">
        <div class="filter-field">
            <label for="id">Id:</label>
            <input type="text" id="id" placeholder="ID...">
        </div>
        <div class="filter-field">
            <label for="titulo">Título:</label>
            <input type="text" id="titulo" placeholder="Título...">
        </div>
        <div class="filter-field">
            <label for="compositor">Compositor:</label>
            <input type="text" id="compositor" placeholder="Compositor...">
        </div>
        <div class="filter-field">
            <label for="instrumento">Instrumento:</label>
            <input type="text" id="instrumento" placeholder="Instrumento...">
        </div>
        <div class="filter-field">
            <label for="dificuldade">Dificuldade:</label>
            <input type="text" id="dificuldade" placeholder="Dificuldade...">
        </div>
        <div class="filter-field">
            <label for="ritmo">Ritmo:</label>
            <input type="text" id="ritmo" placeholder="Ritmo...">
        </div>
        <div class="filter-field">
            <label for="quantidade">Quantidade:</label>
            <input type="text" id="quantidade" placeholder="Quantidade...">
        </div>
        <div class="filter-field">
            <label for="grau">Grau:</label>
            <input type="text" id="grau" placeholder="Grau...">
        </div>
        <div class="filter-field">
            <label for="intervalos">Intervalos:</label>
            <input type="text" id="intervalos" placeholder="Intervalos...">
        </div>
        <div class="filter-field">
            <label for="extensao">Extensão:</label>
            <input type="text" id="extensao" placeholder="Extensão...">
        </div>
        <div class="filter-field">
            <label for="nivel">Nível:</label>
            <input type="text" id="nivel" placeholder="Nível...">
        </div>
        <div id="button-container">
            <button class="search" onclick="filterMusic()">Buscar</button>
            <button class="clear" onclick="clearFilter()">Limpar Filtros</button>
        </div>
    </div>

    <div id="loading">Carregando dados da planilha...</div>
    <div id="no-results">Nenhum resultado encontrado.</div>

    <div id="music-list">
        <h2>Resultados da Busca</h2>
        <div id="songs"></div>
    </div>
    
    <script>
        let allMusicData = [];
        const WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbyjQdLz-iaOJvcu0_FX7l2SP3YbsQuueKq_RqhAtwWiQumkRvwuMjkLTVZwa7sf1MUcTw/exec';

        async function loadSheet() {
            const loading = document.getElementById('loading');
            loading.style.display = 'block';

            try {
                const response = await fetch(WEBAPP_URL);
                const data = await response.json();
                allMusicData = data;
                document.getElementById('music-list').style.display = 'none';
            } catch (error) {
                console.error('Erro ao carregar os dados:', error);
                alert('Erro ao carregar os dados. Por favor, verifique o URL do Web App e as permissões.');
            } finally {
                loading.style.display = 'none';
            }
        }

        function displayMusicList(data) {
            const songsDiv = document.getElementById('songs');
            const musicList = document.getElementById('music-list');
            const noResults = document.getElementById('no-results');

            songsDiv.innerHTML = '';

            if (data.length === 0) {
                musicList.style.display = 'none';
                noResults.style.display = 'block';
            } else {
                musicList.style.display = 'block';
                noResults.style.display = 'none';

                data.forEach((row) => {
                    const div = document.createElement('div');
                    div.className = 'music-item';
                    
                    let content = `
                        <strong>ID:</strong> ${row['Id'] || 'N/A'}<br>
                        <strong>Título:</strong> ${row['Título'] || 'N/A'}<br>
                        <strong>Compositor:</strong> ${row['Compositor'] || 'N/A'}<br>
                        <strong>Instrumento:</strong> ${row['Instrumento'] || 'N/A'}<br>
                        <strong>Dificuldade:</strong> ${row['Dificuldade'] || 'N/A'}<br>
                        <strong>Ritmo:</strong> ${row['Ritmo'] || 'N/A'}<br>
                    `;

                    if (row['Link PDF']) {
                        content += `
                            <strong>Partitura:</strong> <a href="${row['Link PDF']}" target="_blank">Abrir PDF</a><br>
                        `;
                    }
                    
                    if (row['Link MP3']) {
                        content += `
                            <strong>Áudio:</strong> <a href="${row['Link MP3']}" target="_blank">Ouvir MP3</a>
                        `;
                    }
                    
                    div.innerHTML = content;
                    songsDiv.appendChild(div);
                });
            }
        }

        function filterMusic() {
            const filters = {
                id: document.getElementById('id').value.toLowerCase(),
                titulo: document.getElementById('titulo').value.toLowerCase(),
                compositor: document.getElementById('compositor').value.toLowerCase(),
                instrumento: document.getElementById('instrumento').value.toLowerCase(),
                dificuldade: document.getElementById('dificuldade').value.toLowerCase(),
                ritmo: document.getElementById('ritmo').value.toLowerCase(),
                quantidade: document.getElementById('quantidade').value.toLowerCase(),
                grau: document.getElementById('grau').value.toLowerCase(),
                intervalos: document.getElementById('intervalos').value.toLowerCase(),
                extensao: document.getElementById('extensao').value.toLowerCase(),
                nivel: document.getElementById('nivel').value.toLowerCase(),
            };

            const hasFilter = Object.values(filters).some(value => value.trim() !== '');

            if (!hasFilter) {
                alert('Por favor, preencha pelo menos um filtro para pesquisar.');
                return;
            }

            const filteredData = allMusicData.filter(item => {
                return (filters.id === '' || String(item.Id || '').toLowerCase().includes(filters.id)) &&
                       (filters.titulo === '' || String(item.Título || '').toLowerCase().includes(filters.titulo)) &&
                       (filters.compositor === '' || String(item.Compositor || '').toLowerCase().includes(filters.compositor)) &&
                       (filters.instrumento === '' || String(item.Instrumento || '').toLowerCase().includes(filters.instrumento)) &&
                       (filters.dificuldade === '' || String(item.Dificuldade || '').toLowerCase().includes(filters.dificuldade)) &&
                       (filters.ritmo === '' || String(item.Ritmo || '').toLowerCase().includes(filters.ritmo)) &&
                       (filters.quantidade === '' || String(item.Quantidade || '').toLowerCase().includes(filters.quantidade)) &&
                       (filters.grau === '' || String(item.Grau || '').toLowerCase().includes(filters.grau)) &&
                       (filters.intervalos === '' || String(item.Intervalos || '').toLowerCase().includes(filters.intervalos)) &&
                       (filters.extensao === '' || String(item.Extensão || '').toLowerCase().includes(filters.extensao)) &&
                       (filters.nivel === '' || String(item.Nível || '').toLowerCase().includes(filters.nivel));
            });

            displayMusicList(filteredData);
        }

        function clearFilter() {
            const fields = ['id', 'titulo', 'compositor', 'instrumento', 'dificuldade', 'ritmo', 'quantidade', 'grau', 'intervalos', 'extensao', 'nivel'];
            fields.forEach(field => {
                document.getElementById(field).value = '';
            });
            document.getElementById('music-list').style.display = 'none';
            document.getElementById('no-results').style.display = 'none';
        }

        const filterInputs = document.querySelectorAll('#filter-container input');
        filterInputs.forEach(input => {
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    filterMusic();
                }
            });
        });
    </script>
</body>
</html>
