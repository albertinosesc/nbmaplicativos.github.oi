<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Afinador de Instrumentos</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 30px;
    }
    select, button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 16px;
    }
    h1 {
      margin-bottom: 10px;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
    .chromatic-container {
      display: none;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéµ Afinador de Instrumentos</h1>

    <!-- Sele√ß√£o de instrumento -->
    <label for="instrumento">Escolha o instrumento:</label><br>
    <select id="instrumento" onchange="atualizarCordas()">
      <option value="violao">Viol√£o</option>
      <option value="violino">Violino</option>
      <option value="viola">Viola</option>
      <option value="cello">Violoncelo (Cello)</option>
      <option value="ukulele">Ukulele</option>
      <option value="cromatico">Afinador Crom√°tico</option>
    </select><br>

    <!-- Sele√ß√£o de corda (para instrumentos normais) -->
    <div id="stringContainer">
      <label for="cordaSelect">Escolha a corda:</label><br>
      <select id="cordaSelect"></select><br>
    </div>

    <!-- Controles para afina√ß√£o crom√°tica -->
    <div id="chromaticContainer" class="chromatic-container">
      <label for="noteSelect">Nota:</label>
      <select id="noteSelect">
        <option value="C">D√≥ (C)</option>
        <option value="C#">D√≥#/R√©‚ô≠ (C#/Db)</option>
        <option value="D">R√© (D)</option>
        <option value="D#">R√©#/Mi‚ô≠ (D#/Eb)</option>
        <option value="E">Mi (E)</option>
        <option value="F">F√° (F)</option>
        <option value="F#">F√°#/Sol‚ô≠ (F#/Gb)</option>
        <option value="G">Sol (G)</option>
        <option value="G#">Sol#/L√°‚ô≠ (G#/Ab)</option>
        <option value="A">L√° (A)</option>
        <option value="A#">L√°#/Si‚ô≠ (A#/Bb)</option>
        <option value="B">Si (B)</option>
      </select>

      <label for="octaveSelect">Oitava:</label>
      <select id="octaveSelect">
        <option value="0">-2 </option>
        <option value="1">-1 </option>
        <option value="2">1 </option>
        <option value="3">2 </option>
        <option value="4" selected>3 </option>
        <option value="5">4 </option>
        <option value="6">5 </option>
        <option value="7">6 </option>
        <option value="8">7 </option>
      </select><br>
    </div>

    <!-- Bot√µes -->
    <button onclick="startNote()">üéµ Iniciar nota</button>
    <button onclick="stopNote()">‚èπÔ∏è Parar nota</button>
  </div>

  <script>
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    let oscillator = null;
    let gainNode = null;

    const afinacoes = {
      violao: [
        { nome: "6¬™ E (Mi grave)", freq: 82.41 },
        { nome: "5¬™ A (L√°)", freq: 110.00 },
        { nome: "4¬™ D (R√©)", freq: 146.83 },
        { nome: "3¬™ G (Sol)", freq: 196.00 },
        { nome: "2¬™ B (Si)", freq: 246.94 },
        { nome: "1¬™ E (Mi agudo)", freq: 329.63 }
      ],
      violino: [
        { nome: "4¬™ G (Sol)", freq: 196.00 },
        { nome: "3¬™ D (R√©)", freq: 293.66 },
        { nome: "2¬™ A (L√°)", freq: 440.00 },
        { nome: "1¬™ E (Mi)", freq: 659.25 }
      ],
      viola: [
        { nome: "4¬™ C (D√≥)", freq: 130.81 },
        { nome: "3¬™ G (Sol)", freq: 196.00 },
        { nome: "2¬™ D (R√©)", freq: 293.66 },
        { nome: "1¬™ A (L√°)", freq: 440.00 }
      ],
      cello: [
        { nome: "4¬™ C (D√≥ grave)", freq: 65.41 },
        { nome: "3¬™ G (Sol)", freq: 98.00 },
        { nome: "2¬™ D (R√©)", freq: 146.83 },
        { nome: "1¬™ A (L√°)", freq: 220.00 }
      ],
      ukulele: [
        { nome: "4¬™ G (Sol agudo)", freq: 392.00 },
        { nome: "3¬™ C (D√≥)", freq: 261.63 },
        { nome: "2¬™ E (Mi)", freq: 329.63 },
        { nome: "1¬™ A (L√°)", freq: 440.00 }
      ]
    };

    // Frequ√™ncias das notas na oitava 4 (A4 = 440Hz)
    const chromaticNotes = {
      'C': 261.63,
      'C#': 277.18,
      'D': 293.66,
      'D#': 311.13,
      'E': 329.63,
      'F': 349.23,
      'F#': 369.99,
      'G': 392.00,
      'G#': 415.30,
      'A': 440.00,
      'A#': 466.16,
      'B': 493.88
    };

    function atualizarCordas() {
      const instrumento = document.getElementById("instrumento").value;
      const cordaSelect = document.getElementById("cordaSelect");
      const stringContainer = document.getElementById("stringContainer");
      const chromaticContainer = document.getElementById("chromaticContainer");

      if (instrumento === "cromatico") {
        stringContainer.style.display = "none";
        chromaticContainer.style.display = "block";
      } else {
        stringContainer.style.display = "block";
        chromaticContainer.style.display = "none";
        cordaSelect.innerHTML = "";

        afinacoes[instrumento].forEach(corda => {
          const option = document.createElement("option");
          option.value = corda.freq;
          option.textContent = corda.nome;
          cordaSelect.appendChild(option);
        });
      }
    }

    function getChromaticFrequency() {
      const note = document.getElementById("noteSelect").value;
      const octave = parseInt(document.getElementById("octaveSelect").value);
      const baseFrequency = chromaticNotes[note];
      return baseFrequency * Math.pow(2, octave - 4);
    }

    function startNote() {
      stopNote(); // Parar qualquer nota anterior
      
      let freq;
      const instrumento = document.getElementById("instrumento").value;
      
      if (instrumento === "cromatico") {
        freq = getChromaticFrequency();
      } else {
        freq = parseFloat(document.getElementById("cordaSelect").value);
      }

      oscillator = audioCtx.createOscillator();
      gainNode = audioCtx.createGain();

      oscillator.type = 'sine';
      oscillator.frequency.setValueAtTime(freq, audioCtx.currentTime);
      gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);

      oscillator.connect(gainNode);
      gainNode.connect(audioCtx.destination);

      oscillator.start();
    }

    function stopNote() {
      if (oscillator) {
        oscillator.stop();
        oscillator.disconnect();
        gainNode.disconnect();
        oscillator = null;
        gainNode = null;
      }
    }

    // Inicializa as cordas do viol√£o por padr√£o
    window.onload = atualizarCordas;
  </script>
</body>
</html>