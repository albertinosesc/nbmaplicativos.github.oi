<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ABCJS Example</title>
    <script src="../dist/abcjs-basic.js" type="text/javascript"></script>
    <style>
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100' height='100' fill='%238C98F2'><polygon points='0,0 100,0 50,50'/></svg>") no-repeat;
            background-size: 12px;
            background-position: calc(100% - 10px) center;
            background-repeat: no-repeat;
            background-color: #efefef;
            color: black;
            font-size: 18px;
            padding: 5px;
            margin-bottom: 20px;
            width: 350px;
        }
    </style>
</head>
<body onload="load()">
    <select id="abc-options">
        <option value="">Select ABC Notation</option>
        <option value="X:1
T:Adagio
C:Corelli, arr. for trio
Z:arr. Ian Hayden 2021
L:1/8
M:3/4
K:F
V:1 name=melody
z6|(F2B3_A|G2_E2)z2|d2g3f|
_e2c2z2|a2d'3c'|(b2_e2) e2|(_e2d2)d2|gBPc3d|
d2a4-|a2g4-|g2f4|(_e2^c2)Md2-|de e4|
d2f4-|f3 g_ed|_ef d4|c2_e4-|
e3 fdc|d_e c4|B2 b4-|bg _a4|
_a^f g4-|g2^f2c2-|c2 =Bc d2-|d2G2_e2|
(^F2D2)d2|_e2^f4|g6-|g2 g3^f|g2 d4-|
d2G2_e2|^F4d2|(cB) A4|G2Hd2Hc2|Hd6|]
V:2 name=guitar
z6|[FB,]6|B,4z2|[dGG,]6|
G4z2|[dAD]4c2|B6&D2_E4|[AE]2D2[AD]2|G6&D2 CB,A,2|
A4x2&^F2A2d2-|d2d4&A2G4|[^cG]2[fdF]4|[B_E]2[G=E]2[FD]2|[BE]2d2^c2|
[AF]2 [dA]4|[dG]4G2|_A2 [cG]2-=B2|_E2 [cG]4|
[cF]4 F2|[BG]2 [BF]2A2|D2[BF]2G2|[BD]2 [_A_E]2F2|
_Az[DG]2 _E2|G2[DA]4|D4[G=BD]2|[GC]4C2&D2x2G2|
A,4[GD]2|[_EG]2^F4&x2d2c2|[BG]2d2e2|[GB]2[_e=A]3[cd^F]|[G,GBd]2z2G2|
D2(CB,) [_EA,]2|[A,D]4 [BDG,]2|(_ED) [CG]2 [^F]2|[BD]2[[DG]2[G_EC]2|[A^FD]6|]
V:3: name=cello
_E,2G,2E,2|D,2B,,2D,2|_E,2G,2E,2|=B,,2G,,2B,,2|
C,2_E,2C,2|^F,2D,2F,2|G,4G,2|^F,4=F,2|_E,6|
D,4C,2|B,,4G,,2|A,,4D,2|G,2A,2B,2|G,2A,2A,,2|
D,2 D2 C2|=B,2 G,2 C2|F,2 G,2 G,,2|C,2C2B,2|
A,2F,2B,2|_E,2F,2F,,2|B,,2(D,2=E,2|F,2)C,2D,2|
_E,2 B,,2C,2|D,6|G,4F,2|_E,4C,2|
D,4_B,,,2|C,,4D,,2|_E,,2B,,,2C,,2|D,,2C,,2D,,2|G,,4B,,2|
_E,4C,2-|C,2D,2B,,2|C,2D,2D,,2|G,,2F,,2_E,,2|D,,6|]




%%topmargin 3
%%botmargin 3
%%barnumbers 3
%%%%barsperstaff 4
%%staffsep 70
%%scale 0.7
%%footer -$P">
Adagio</option>

<option value="X:2
T:Concerto for Lute, RV 93
C:Antonio Vivaldi  
Z:arr. Ian Hayden 2020
L:1/8
M:C
K:D
P:Allegro
V:1 scale=1.2
|:(f/e/d) (f/e/d) aAAA|(f/e/d) (f/e/d) aAAA|\
(a/g/f) (a/g/f) e2z2|
(a/g/f) (a/g/f) (d/c/B) (d/c/B)|\
(g/f/e) (g/f/e) (c/B/A) (c/B/A)|\
f2z=f fe ef/g/|=fddf feef/g/|
=fddd _ee=ee|=ff^ff gg^gg|az az az z=g|\
f/g/a/f/ e/f/g/e/ f/g/a/f/ e/f/g/e/|
d2z d (f/e/d) (a/g/f)|eAAA (e/d/c) (g/f/e)|\
fdda (b/a/g) (b/a/g)|e/c/c/c/ e/c/c/c/ (a/g/f) (a/g/f)|
d/B/B/B/ d/B/B/B/ (g/f/e) (g/f/e)|(f/e/d) (f/e/d) (^g/f/e) (^g/f/e)|\
ac/d/ e/d/e/d/ c/d/c/d/ e/d/e/d/|ce a^g/f/ eefe/d/|
cea^g/f/ eefe/d/|cB/A/ ed/c/ acdB|cB/A/ ed/c/ acdB|Aab^g a4:|
|:(c/B/A) (c/B/A) eEEE|(c/B/A) (c/B/A) eEEE|(c/B/A) (c/B/A)^G2z2|aeAg fdDf|
bfBa ^geEg|c'^gcb [acf]4|[^gc]4 [acf]4|[^gc]4 [acf]2z2|
[^acf]4[bdf]4|[^acf]4[bdf]4|[^acf]4[bdf]2z2|ba/g/ fe dbdb |
ebfb gbdb|ebf^ab2z2|ba/g/ fe dBDB|EBFB GBDB|
EBF^AB2zf|(f/e/d) (f/e/d) aAAA|(f/e/d) (f/e/d) (a/g/f) (a/g/f)|e2z=f feef/g/|
=fddf feef/g/|=fdda _bbba/g/|aaag/=f/ gggf/e/|=ff^ff gg^gg|
a/a/a/a/ a/a/a/a/ g/g/g/g/ g/g/g/g/|fe/d/ ec f/g/a/f/ e/f/g/e/|\
f/g/a/f/ e/f/g/e/ f/g/a/f/ e/f/g/e/|fdec Hd4:|
V:2 scale=1.2
|:(a/g/f) (a/g/f) eAAA|(a/g/f) (a/g/f) eAAA|(f/e/d) (f/e/d) c2z2|
(a/g/f) (a/g/f) (d/c/B) (d/c/B)|(g/f/e) (g/f/e) (c/B/A) (c/B/A)|\
"D"f2z"Dm"=f fe "A"ef/g/|"Dm"=fddf f"A"eef/g/|
"Dm"=fddd "Cm"_ee"C7"=ee|"Dm"=ff"D7"^ff "Gm"gg"E"^gg|"A"az az az z=g|\
"D"d/e/f/d/ "A"c/d/e/c/ "D"d/e/f/d/ "A"c/d/e/c/|
"D"d2z2z4|"A"z8|"D"z4"G"z4|"A"z4"D"z4|
"G"z4"A"z4|"D"z4"E"z4|"A"aA/B/ c/B/c/B/ A/B/A/B/ c/B/c/B/|"A"[Ac]2z2z4|
"A"z8|"A"z4z2"E"z2|"A"z4z2"E"z2|"A"zcdB A4:|
|:"A"(e/d/c) (e/d/c) "E"BEEE|"A"(e/d/c) (e/d/c) "E"BEEE|"A"(e/d/c) (e/d/c) "E"B2z2|"A"z4"D"z4|
"B"z4"E"z4|"C#"z4"F#m"[acF]4|"C#"[^gcF]4-"F#m"[acF]4-|"C#"[^gcF]4"F#m"cf/^g/ af|"F#"[cF]4-"Bm"[dF]4|
"F#"[cF]4-"Bm"[dF]4-|"F#"[cF]4z"Bm"d/e/fd|"Bm"z8|"Em"z8|z2"F#"z2"Bm"zd/e/fd|"Bm"z8|
z8|z4z2za|"D"(a/g/f) (a/g/f) "A"eAAA|(a/g/f) (a/g/f) (f/e/d) (f/e/d)|
"A"[ec]2z2"Dm"z4|z8|"Dm"z4"Gm"z2"C"z2|"F"z2"Gm"z2"Em"z2"A"z2|"Dm"z2"D7"z2"Gm"z2"E"z2|
"A"z8|"D"z2"A"z2d/e/f/d/ c/d/e/c/|"D"d/e/f/d/ "A"c/d/e/c/ "D"d/e/f/d/ "A"c/d/e/c/|"D"df"A"gc "D"Hd4:|
V:3 clef=bass scale=1.2
|:D,D,D,D, C,C,C,C,|D,D,D,D, C,C,C,C,|D,D,D,/E,/F,/G,/ A,2z2|
F,D,F,D, B,G,B,G,|E,C,E,C, A,A,,A,A,,|D,2zD, D,A,,A,,A,,|D,D,D,D, D,A,,A,,A,,|
D,D,D,D, =C,C,_B,,B,,|A,,A,, D,=C, _B,,B,, E,D,|C,D,C,B,, A,,B,,C,A,,|D,D,  A,,A,, D,D, A,,A,,|
D,2zD, D,E,F,D,|A,,B,,C,B,, A,,B,,C,A,,|D,E,F,D, G,F,G,G,,|CB,CC, F,E,F,F,,|
B,A,B,B,, E,D,E,E,,|D,C,D,E,, E,F,E,D,|A,,2 A,,2 A,,2 A,,2|A,,2z2A,,2z2|
A,,2z2A,,2z2|A,,2A,,2 A,,A,D,E,|A,,2A,,2A,,A,D,E,|A,,A,D,E, A,,4:|
|:A,,A,,A,,A,, ^G,,G,,G,,G,,|A,,A,,A,,A,, ^G,,G,,G,,G,,|A,,A,, A,,/B,,/C,/D,/ E,F,E,D,|C,3A,,D,2D,,2|
^D,3B,,E,2E,,2|^E,3C, F,,E,/^G,/ A,F,|zC,/^D,/^E,C, zF,/^G,/A,F,|zC,/^D,/^E,C,F,2z2|\
zF,/^G,/A,F, zB,,/C,/D,B,,|
zF,/^G,/^A,F, zB,,/C,/D,B,,|zF,/^G,/^A,F,B,,2z2|B,,2^A,,2B,,2B,,2|C,2D,2E,2B,,2|\
C,2F,,2B,,2z2|B,,2^A,,2B,,2B,,2|
C,2D,2E,2B,,2|C,2F,,2B,,2zD,|D,D,D,D, A,,A,,A,,A,,|D,D,D,D, D,D, D,/E,/F,/G,/|
A,G,=F,D,A,,2A,,2|D,2D,2A,,2A,,2|D,2D,2G,2=C,2|=F,2_B,,2E,2A,,2|D,D,=C,C, _B,,B,,E,D,|
C,=B,,C,A,, C,B,,C,A,,|D,F,G,A, D,D,A,,A,,|D,D,A,,A,, D,D,A,,A,,|D,DG,A, HD,4:|">
Concerto for Lute, RV 93</option>

<option value="X:3
T:Largo
C:Antonio Vivaldi
Z:arr. Ian Hayden 2020
L:1/8
M:C
K:D
Q:1/4=60
V:1 scale=1.2
|:d>fg>a d>fg>a|e>cd>e A>ba>g|f>ad>f a>fe>d|e2A2z2a2|
a>fe>d a>fe>d|babb babb|befe befe|agaa agaa|
aded aded|^gaba gfed|ccBA ecBA|acBA ecBA|
abab abab|a2 ^gf edcB|ceac B2 ^g2|a4-a4:|
|:g>eB>e g>bg>e|^A>cF>c e>gf>e|dcB2z2f2|f/B/c/B/ c/B/c/B/ f/B/c/B/ c/B/c/B/|
b/f/g/f/ g/f/g/f/ b/f/g/f/ g/f/g/f/|bfed c2>B2|B4z2d2|d>fg>a d>fa>f|
ecde Agbg|fed2z2a2|abag fed=c|BAG2 z2b2|
bc'ba gfed|cBA2 zceg|f/A/B/A/ B/A/B/A/ f/A/B/A/ B/A/B/A/|\
e/A/B/A/ B/A/B/A/ g/A/B/A/ B/A/B/A/|
f>ga>d Te3d|Hd8:|
V:2 scale=1.2
|:"D"[fd]4-[fd]4|"A"[ec]4-[ec]4|"D"[df]4-[df]4|"A"[ec]4-[ec]4|
"D"[df]4[fa]4|"G"[fb]4-[fb]4|"C#m"[eb]4-[eb]4|"F#m"[ea]4-[ea]4|
"Bm7"[da]4-[da]4|"E7"[d^g]4-[d^g]4|"A"[ce]4-[ce]4|"A"[ce]4-[ce]4|
"A"[ce]4-[ce]4|[ce]4 z4|[ca]4[B^g]4|"A"[ca]4-[ca]4:|
|:"Em"[Be]4-[Be]4|"F#"[^Ac]4-[^Ac]4|"Bm"[Fd]4-[Fd]4|"Bm"[df]4-[df]4|
"Bm"[df]4-[fd]4-|"Bm"[df]2[Bd]2"F#"[^Ac]4|"Bm"[Fd]4-[Fd]4|"D"[df]4-[df]4|
"A"[ce]4-[ce]4|"D"[Af]4-[Af]4|"D"[Af]4-[Af]4|"G"[Bd]4-[Bd]4|
"G"[Bd]4-[Bd]2[gB]2|"A"[ce]4-[ce]4|"D"[df]4-[df]4|"A"[ce]4-[ce]4|
"D"[df]4 "A"[ce]4|"D"[df]8:|
V:3 clef=bass scale=1.2
|:D,2D,2D,2D,2|A,2A,,2A,,2A,,2|D,2D,2D,2D,2|A,2A,,2A,,2A,,2|
D,2D,2D,2D,2|G,2,G,2G,2,G,2|C,2C,2C,2C,2|F,2F,2F,2F,2|
B,,2B,,2B,,2B,,2|E,2E,2E,2E,2|A,,2A,,2A,,2A,,2|A,,2A,,2A,,2A,,2|
A,,2A,,2A,,2A,,2|A,,4 z4|A,,2A,,2E,,2E,,2|A,,4-A,,4:|
|:E,2E,2E,2E,2|F,2F,2F,2F,2|B,,2B,,2B,,2B,,2|B,,2B,,2 B,,2B,,2|
B,,2B,,2 B,,2B,,2|B,,2B,,2F,2F,,2|B,,2B,,2 B,,2B,,2|D,2D,2D,2D,2|
A,,2A,,2A,,2A,,2|D,2D,2D,2D,2|D,2D,2D,2D,2|G,,2G,,2G,,2G,,2|
G,,2G,,2G,,2G,,2|A,,2A,,2A,,2A,,2|A,,2A,,2A,,2A,,2| A,,2A,,2A,,2A,,2| 
D,2D,2A,,2A,,2|HD,8:|">
Largo</option>


    </select>

    <textarea id="abc-input" rows="10" cols="50"></textarea>
    <div id="paper"></div>
    
    <fieldset>
        <legend>Options</legend>
        <h2>Transpose Parameters</h2>
        <label>Visual:
            <input class="visual-transpose" type="number" min="-24" max="24" step="1" value="0">
        </label>
        <label>Audio:
            <input class="audio-transpose" type="number" min="-24" max="24" step="1" value="0">
        </label>
        <h2>ABC Insertions</h2>
        <button class="midi-command">Add %%MIDI command</button>
        <button class="key-command">Add transpose to K:</button>
        <button class="voice-command">Add transpose to V:</button>
    </fieldset>

    <button class="play-chords">Acorde</button>
    <button class="play-melodies">V1-V2</button>
    <button class="play-harmony">V1</button>
    <button class="play-melody">V2</button>
    <button class="play-all">Play All</button>
    <button class="stop-audio" style="display:none;">Stop</button>
    <div class="audio-error" style="display:none;">Audio not supported</div>

    <script type="text/javascript">
        function load() {
    var abcTextarea = document.getElementById("abc-input");
    var abcSelect = document.getElementById("abc-options");
    var visualObj;

    function renderABC() {
        var abc = abcTextarea.value;
        var visualTranspose = parseInt(document.querySelector(".visual-transpose").value, 10);
        visualObj = ABCJS.renderAbc("paper", abc, { responsive: "resize", visualTranspose: visualTranspose })[0];
    }

    abcTextarea.addEventListener("input", renderABC);
    document.querySelector(".visual-transpose").addEventListener("input", renderABC);
    renderABC();

    abcSelect.addEventListener("change", function() {
        if (abcSelect.value) {
            abcTextarea.value = abcSelect.value;
            renderABC();
        }
    });

    var midiBuffer;
    var startChordsButton = document.querySelector(".play-chords");
    var startMelodiesButton = document.querySelector(".play-melodies");
    var startHarmonyButton = document.querySelector(".play-harmony");
    var startMelodyButton = document.querySelector(".play-melody");
    var startAllButton = document.querySelector(".play-all");
    var stopAudioButton = document.querySelector(".stop-audio");

    startChordsButton.addEventListener("click", function() {
        var options = { voicesOff: true };
        play(options);
    });

    startMelodiesButton.addEventListener("click", function() {
        var options = { chordsOff: true };
        play(options);
    });

    startHarmonyButton.addEventListener("click", function() {
        var options = { chordsOff: true, voicesOff: [1] };
        play(options);
    });

    startMelodyButton.addEventListener("click", function() {
        var options = { chordsOff: true, voicesOff: [0] };
        play(options);
    });

    startAllButton.addEventListener("click", function() {
        var options = {};
        play(options);
    });

    function play(options) {
        startChordsButton.style.display = "none";
        startMelodiesButton.style.display = "none";
        startHarmonyButton.style.display = "none";
        startMelodyButton.style.display = "none";
        startAllButton.style.display = "none";
        if (ABCJS.synth.supportsAudio()) {
            stopAudioButton.style.display = "";

            window.AudioContext = window.AudioContext ||
                window.webkitAudioContext ||
                navigator.mozAudioContext ||
                navigator.msAudioContext;
            var audioContext = new window.AudioContext();
            audioContext.resume().then(function () {
                midiBuffer = new ABCJS.synth.CreateSynth();
                var audioTranspose = parseInt(document.querySelector(".audio-transpose").value, 10);
                return midiBuffer.init({
                    visualObj: visualObj,
                    audioContext: audioContext,
                    millisecondsPerMeasure: visualObj.millisecondsPerMeasure(),
                    options: options,
                    midiTranspose: audioTranspose
                }).then(function (response) {
                    return midiBuffer.prime();
                }).then(function () {
                    return midiBuffer.start();
                }).catch(function (error) {
                    if (error.status === "NotSupported") {
                        stopAudioButton.style.display = "none";
                        var audioError = document.querySelector(".audio-error");
                        audioError.style.display = "";
                    } else {
                        console.warn("synth error", error);
                    }
                });
            });
        } else {
            var audioError = document.querySelector(".audio-error");
            audioError.style.display = "";
        }
    }

    stopAudioButton.addEventListener("click", function() {
        startChordsButton.style.display = "";
        startMelodiesButton.style.display = "";
        startHarmonyButton.style.display = "";
        startMelodyButton.style.display = "";
        startAllButton.style.display = "";
        stopAudioButton.style.display = "none";
        if (midiBuffer) {
            midiBuffer.stop();
        }
    });

    document.querySelector(".midi-command").addEventListener("click", onMidiCommand);
    document.querySelector(".key-command").addEventListener("click", onKeyCommand);
    document.querySelector(".voice-command").addEventListener("click", onVoiceCommand);

    function onMidiCommand() {
        var abc = abcTextarea.value;
        abc = abc.split("\n");
        abc[0] += "\n%%MIDI transpose 2";
        abc = abc.join("\n");
        abcTextarea.value = abc;
        renderABC();
    }

    function onKeyCommand() {
        var abc = abcTextarea.value;
        abc = abc.split("K:");
        if (abc.length > 1) {
            var arr = abc[1].split("\n");
            arr[0] = " Em transpose=-2";
            abc[1] = arr.join("\n");
        }
        abc = abc.join("K:");
        abcTextarea.value = abc;
        renderABC();
    }

    function onVoiceCommand() {
        var abc = abcTextarea.value;
        abc = abc.split("V:");
        if (abc.length > 1) {
            var arr = abc[1].split("\n");
            arr[0] = " Melody transpose=-2";
            abc[1] = arr.join("\n");
        }
        abc = abc.join("V:");
        abcTextarea.value = abc;
        renderABC();
    }
}
    </script>
</body>
</html>